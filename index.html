<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROLETA IAP BRASIL üáßüá∑</title>

<link rel="manifest" href="manifest.webmanifest">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Passion+One:wght@400;700&family=Roboto:wght@400;700&display=swap" />

<style>
/* ================== CONFIGURA√á√ÉO DE CORES E FONTES (TROPICAL BRASIL) ================== */

:root{
  --bg:#E0F7FA; /* Fundo Azul Claro (C√©u/Mar) */
  --panel:#FFFFFF; /* Fundo do Card (Branco/Areia Clara) */
  --accent:#FFC300; /* Amarelo Ouro/Sol (Acento Principal) */
  --accent-secondary:#0079C0; /* Azul do Mar (Acento Secund√°rio) */
  --muted:#555555; /* Cinza Escuro Suave (Texto Comum) */
  --zero:#FF8C00; /* Laranja Forte/Gold (Zero) */
  --red:#B70404; /* Vermelho Vibrante */
  --black:#17202A; /* Azul Escuro/Carv√£o (Para n√∫meros e inputs) */
  --btn-main:linear-gradient(90deg, var(--accent), var(--accent-secondary)); 
  --alert-red:#D83C3C;
  --alert-green:#00A859; /* Verde Bandeira */
  --lock-bg:rgba(255, 255, 255, 0.95); /* Bloqueio Claro com Blur */
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Roboto',sans-serif; /* Fonte mais clean para leitura */
  background:var(--bg);
  color:#17202A; /* Texto escuro no fundo claro */
  padding:14px;
}
.hidden { display: none !important; }

/* Corre√ß√£o da Tela de Login: impede rolagem */
body.login-active {
    height: 100vh;
    overflow: hidden;
}

/* ================== TELA DE LOGIN ================== */
#loginScreen {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    position: fixed; 
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    z-index: 8000; 
}
#loginBox {
    background: var(--panel);
    border-radius: 12px;
    padding: 30px;
    max-width: 400px;
    width: 100%;
    /* Novo Box Shadow mais tropical */
    box-shadow: 0 0 40px rgba(0, 121, 192, 0.1), 0 5px 15px rgba(0,0,0,0.1); 
    border: 1px solid rgba(0, 121, 192, 0.2);
    text-align: center;
}
.login-title{
    font-family:'Passion One', cursive; /* Fonte vibrante para t√≠tulos */
    font-weight: 700;
    font-size: 32px;
    color: var(--accent);
    margin-bottom: 5px;
    text-shadow: 0 0 5px rgba(255, 195, 0, 0.5);
}
.login-subtitle {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 25px;
}
#authPwd{
    width: 100%;
    padding: 12px;
    background: #F0F0F0; /* Fundo do input mais claro */
    border: 1px solid var(--accent-secondary);
    border-radius: 6px;
    color: var(--black);
    font-family: 'Roboto', sans-serif; /* Mantido como leitura */
    font-size: 16px;
    transition: border-color 0.2s, box-shadow 0.2s;
    margin-top: 15px;
}
#authPwd:focus {
    outline: none;
    border-color: var(--zero);
    box-shadow: 0 0 10px rgba(255,140,0,0.5);
    background: #fff;
}

/* ================== LAYOUT E COMPONENTES MODERNOS ================== */

/* Header / clock */
.header{
  /* Novo gradiente de Mar e Sol */
  background: linear-gradient(90deg, rgba(255,195,0,0.2), rgba(0,121,192,0.1)); 
  border-radius:8px; 
  padding:12px; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  box-shadow:0 0 15px rgba(0,0,0,0.1);
  border: 1px solid rgba(0,121,192,0.1);
}
.title{
  font-family:'Passion One', cursive;
  font-weight:700;
  font-size:24px;
  color: var(--accent-secondary); /* T√≠tulo em Azul do Mar */
  text-shadow: 0 0 5px rgba(0, 121, 192, 0.5);
}
#clock{
  color:var(--zero);
  font-family:'Passion One', cursive;
  font-weight:700;
  text-shadow:0 0 8px rgba(255,140,0,0.5);
}
#sessionTimer{
    font-size: 10px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    margin-left: 10px;
}

/* card */
.card{
  background:var(--panel);
  border-radius:12px;
  padding:15px;
  margin-top:14px;
  /* Sombra mais suave */
  box-shadow:0 5px 20px rgba(0,0,0,0.1), inset 0 0 8px rgba(0,121,192,0.05); 
  border:1px solid rgba(0,121,192,0.1);
  transition: all 0.3s ease;
}

/* T√≠tulos / Sugest√µes */
.suggestionTitle{
  font-family:'Passion One', cursive;
  font-weight:700;
  color:var(--accent); /* T√≠tulos em Amarelo Sol */
  margin-bottom:8px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 1px dashed rgba(0, 121, 192, 0.3);
  padding-bottom: 5px;
}
.suggestionBox{
  font-size:15px;
  color:var(--black); /* Texto escuro */
  line-height:1.7;
}
.iaGlow{
  color:var(--accent-secondary); /* Cor secund√°ria para o Booster */
  text-shadow:0 0 10px rgba(0, 121, 192, 0.6);
  /* Brilho mais suave */
  animation:glowPulse 2s infinite alternate;
}
@keyframes glowPulse{
  0%{text-shadow:0 0 3px rgba(0, 121, 192, 0.2)}
  100%{text-shadow:0 0 10px rgba(0, 121, 192, 0.8)}
}

.data-separator {
  height: 1px;
  /* Gradiente de Sol para Mar */
  background: linear-gradient(90deg, var(--accent), var(--accent-secondary), rgba(0,0,0,0));
  margin: 12px 0;
  opacity: 0.7;
}

/* ================== BOT√ïES E INPUTS ================== */

/* grid numbers */
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
  gap:8px;
  justify-content:center;
  margin-top: 10px;
}
.number-btn{
  width:100%; height:45px;
  border-radius:8px;
  border:1px solid rgba(0, 0, 0, 0.1);
  font-family:'Passion One', cursive;
  font-weight:700;
  cursor:pointer;
  transition:transform .14s,box-shadow .14s, border-color 0.14s;
  color: var(--black); /* Texto escuro */
}
.number-btn:hover{
    transform:scale(1.05); 
    box-shadow:0 0 15px rgba(0,121,192,0.4);
    border-color: var(--accent-secondary);
}
.red{background:var(--red);color:#fff}
.black{background:var(--black);color:#fff}
.zero, .green {background:var(--zero);color:var(--black)} 

/* Bot√µes de controle */
.control-btn{
  background:var(--btn-main);
  border:0;
  border-radius:6px;
  padding:12px 14px;
  color:#fff; /* Texto branco no gradiente */
  font-weight:700;
  font-family:'Passion One', cursive;
  cursor:pointer;
  transition: all .2s;
  margin: 4px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  text-transform: uppercase;
  display: flex; /* Para alinhar o √≠cone */
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.control-btn:hover{
    opacity:0.95; 
    box-shadow: 0 0 15px rgba(255,195,0,0.8);
    transform: translateY(-2px);
}
.control-btn:active{transform: translateY(1px);}
.control-btn:disabled { 
    opacity: 0.3; 
    cursor: not-allowed; 
    box-shadow: none; 
}


.btn-win { background: var(--alert-green); color: #fff; }
.btn-loss { background: var(--alert-red); color: #fff; }

/* Estilos de Entrada (Input) */
.bankroll-label {
    font-size: 11px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    margin-bottom: 4px;
    margin-top: 8px;
}
.bankroll-input {
    width: 100%;
    padding: 10px;
    background: #F0F8FF; /* Fundo do input mais claro */
    border: 1px solid var(--accent-secondary);
    border-radius: 6px;
    color: var(--black);
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    transition: border-color 0.2s;
}
.bankroll-input:focus {
    outline: none;
    border-color: var(--zero);
    box-shadow: 0 0 8px rgba(255,140,0,0.5);
    background: #fff;
}

/* ================== AN√ÅLISE E DASHBOARD DE BANCA ================== */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;
    margin-top: 10px;
    padding-top: 10px;
}
.stat-item {
    background: #F0F8FF; /* Fundo do stat item mais suave */
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid var(--accent-secondary);
    box-shadow: inset 0 0 5px rgba(0, 121, 192, 0.1);
}
.stat-title {
    font-size: 11px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    margin-bottom: 5px;
}
.stat-value {
    font-size: 18px;
    font-weight: 700;
    font-family: 'Passion One', cursive;
    color: var(--black);
}
.positive { color: var(--alert-green) !important; text-shadow: 0 0 3px rgba(0, 168, 89, 0.5);}
.negative { color: var(--alert-red) !important; text-shadow: 0 0 3px rgba(216, 60, 60, 0.5);}

/* Hist√≥ria de Padr√µes (Chips) - ALTERADO PARA LINHA √öNICA */
.history{
    display: flex;
    flex-wrap: nowrap;
    gap: 8px;
    margin-top: 10px;
    max-width: 100%;
    overflow-x: auto;
    padding: 8px 5px;
    background: rgba(0,0,0,0.1); /* Fundo da hist√≥ria mais claro */
    border-radius: 6px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; 
}
.history::-webkit-scrollbar {
    display: none; 
}
.chip{
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.2);
    transition: transform 0.1s;
    font-family: 'Passion One', cursive;
}
.chip:hover { transform: scale(1.15); box-shadow: 0 0 10px var(--accent-secondary);}
.chip.zero { background: var(--zero); color: var(--black); }
.chip.red { background: var(--red); color: #fff; }
.chip.black { background: var(--black); color: #fff; border-color: rgba(255,255,255,0.5);}

/* An√°lise de Padr√µes/Tabela */
.analysis-output {
    background: #F0F8FF; 
    border: 1px solid var(--accent-secondary);
    border-radius: 8px;
    padding: 12px;
    box-shadow: inset 0 0 5px rgba(0, 121, 192, 0.1);
}
.pattern-line {
    font-size: 14px;
    margin-bottom: 6px;
    line-height: 1.4;
    color: var(--black);
}
.pattern-trigger {
    color: var(--zero);
    font-weight: bold;
    font-family: 'Passion One', cursive;
}
.pattern-succession {
    color: var(--accent);
    font-weight: bold;
}
.pattern-count {
    color: var(--muted);
    font-size: 12px;
}

/* Extrato */
#bankrollHistory {
    max-height: 150px;
    overflow-y: auto;
    padding: 5px;
    background: rgba(0,0,0,0.1); 
    border-radius: 6px;
}
.log-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    margin-bottom: 4px;
    border-radius: 4px;
    font-size: 14px;
    transition: background 0.2s;
}
.log-win { background: rgba(0, 168, 89, 0.1); border-left: 3px solid var(--alert-green); color: var(--alert-green);}
.log-loss { background: rgba(216, 60, 60, 0.1); border-left: 3px solid var(--alert-red); color: var(--alert-red);}
.log-delete-btn {
    background: none;
    border: none;
    color: var(--muted);
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s;
}
.log-delete-btn:hover { color: var(--black); }

/* ================== TELA DE BLOQUEIO (CADEADO) ================== */

#lockScreen{
  position:fixed;
  inset:0;
  background:var(--lock-bg);
  backdrop-filter: blur(6px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9000;
  text-align:center;
}
#lockScreen svg {
    color: var(--alert-red);
    margin-bottom: 10px;
}
#lockScreen h2{
  font-family:'Passion One', cursive;
  color:var(--alert-red);
  font-size:32px;
}
#lockScreen h2.win {
  color:var(--alert-green);
}
#lockScreen p{
  font-size:18px;
  color:var(--muted);
  margin-top: 10px;
}
#lockScreen .countdown{
  font-family:'Passion One', cursive;
  font-size:52px;
  font-weight:700;
  color:var(--accent-secondary);
  margin-top:20px;
  margin-bottom: 25px;
  text-shadow: 0 0 15px rgba(0, 121, 192, 0.8);
}
</style>
</head>
<body id="bodyTag">

<div id="lockScreen" class="hidden">
  <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" fill="currentColor" viewBox="0 0 16 16" id="lockIcon">
    <path d="M8 1a2 2 0 0 0-2 2v4h4V3a2 2 0 0 0-2-2m3 6V3a3 3 0 1 0-6 0v4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1zM4 8a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5z"/>
  </svg>
  <h2 id="lockTitle">ZONA SEGURA ATINGIDA (STOP LOSS)</h2>
  <p>An√°lise bloqueada. Retorne ap√≥s o per√≠odo de resfriamento:</p>
  <div class="countdown" id="countdownTimer">02:00:00</div>
  
  <button id="btnSkipLock" class="control-btn" 
          style="margin-top: 30px; background: #6c757d; font-size: 16px;">
      <span class="material-symbols-outlined">lock_open</span>
      PULAR BLOQUEIO (QUEBRAR REGRA)
  </button>
</div>


<div id="loginScreen"> 
  <div id="loginBox">
    <div class="login-title">IAP BRASIL üáßüá∑</div>
    <div class="login-subtitle">Interface de An√°lise de Padr√µes</div>

    <div id="signInForm">
      <input id="authPwd" type="password" placeholder="Senha de Acesso (Modo Real)" autocomplete="current-password" required><br>
      
      <div style="display:flex; gap:10px; margin-top:15px;">
          <button id="btnSignInReal" class="control-btn" style="flex:1; background: linear-gradient(90deg, #ffc400, #ff8c00); color: var(--black);">MODO REAL</button>
          <button id="btnSignInDemo" class="control-btn" style="flex:1; background: var(--btn-main); color: #fff;">MODO DEMO</button>
      </div>
      
    </div>
    
  </div>
</div>

<div id="mainPanel" class="hidden">
  <div class="header">
    <div style="display: flex; align-items: center;">
        <div class="title">IAP BRASIL</div>
        <div id="sessionTimer">Sess√£o: -:-</div>
    </div>
    <div id="clock">--:--:--</div>
  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">payments</span>
        GEST√ÉO DE BANCA E RISCO
    </div>
    
    <div class="bankroll-grid" style="display:flex; gap: 15px;">
        <div style="flex:1;">
            <div class="bankroll-label">BANCA INICIAL (R$)</div>
            <input id="initialBankrollInput" type="number" class="bankroll-input" placeholder="1000" min="0" step="0.01">
            <button id="btnSetBankroll" class="control-btn" style="width: 100%; margin-top: 8px;">
                <span class="material-symbols-outlined">account_balance</span>
                DEFINIR BANCA
            </button>
        </div>
        <div class="bankroll-actions" style="flex:1;">
            <div class="bankroll-label">REGISTRAR ENTRADA (R$)</div>
            <input id="betAmountInput" type="number" class="bankroll-input" placeholder="Valor ganho/perdido" min="0" step="0.01">
            <div style="display:flex; gap: 8px;">
                <button id="btnRegisterWin" class="control-btn btn-win" style="flex:1; margin-top: 8px;">GREEN (+)</button>
                <button id="btnRegisterLoss" class="control-btn btn-loss" style="flex:1; margin-top: 8px;">RED (-)</button>
            </div>
        </div>
    </div>
    
    <div class="data-separator"></div>
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">monitoring</span>
        ESTAT√çSTICAS DE DESEMPENHO
    </div>
    <div id="performanceDashboard" class="dashboard-grid">
      <span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>
    </div>

  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">receipt_long</span>
        EXTRATO DE TRANSA√á√ïES
    </div>
    <div id="bankrollHistory" class="bankroll-history-list">
      <div class="log-item log-placeholder">Nenhum registro ainda.</div>
    </div>
  </div>
  
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="suggestionTitle history-title">
        <span class="material-symbols-outlined">history</span>
        HIST√ìRICO DA ROLETA <span id="historyCount" class="history-subtitle">0/100</span>
      </div>
      <div class="history-subtitle" style="font-size:11px;color:var(--muted)">Recentes ‚Üí Antigos (Scroll)</div> 
    </div>
    <div id="history" class="history"></div>
  </div>

  <div class="card">
    <div class="suggestionTitle" style="color: var(--accent-secondary); border-bottom-color: var(--accent-secondary);">
        <span class="material-symbols-outlined">settings_ethernet</span>
        SELETOR DE PADR√ïES (I.A. GATILHO)
    </div>
    <select id="patternSelector" class="bankroll-input" style="margin-top: 5px;">
        <option value="zoneSuccession">ZONA 5 (Sucess√£o de Zonas)</option>
        <option value="fourSuccessors">4 SUCESSORES (Gatilho + 4)</option>
    </select>
  </div>
  

  <div class="card" id="boosterCard">
    <div class="suggestionTitle iaGlow">
        <span class="material-symbols-outlined">magic_button</span>
        BOOSTER DE APOSTA I.A. (<span id="currentPatternName">ZONA 5</span>)
    </div>
    <div id="betSuggestion" class="suggestionBox" style="font-size: 16px; font-weight: 700;">
        <span style="color:var(--muted)">Aguardando dados ou aguardando desbloqueio...</span>
    </div>
  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">auto_fix</span>
        AN√ÅLISE DETALHADA DO PADR√ÉO
    </div>
    <div id="patternAnalysisOutput" class="suggestionBox">Selecione um padr√£o e adicione n√∫meros ao hist√≥rico para ver a an√°lise.</div>
  </div>
  
  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">dialpad</span>
        ENTRADAS R√ÅPIDAS
    </div>
    <div class="grid" id="gridNumbers"></div>
    <div class="data-separator"></div>
    <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <button id="btnUpload" class="control-btn" style="flex:1 1 150px;">
            <span class="material-symbols-outlined">camera_alt</span>
            üì∏ Enviar foto
        </button> 
        <button id="clearBtn" class="control-btn btn-loss" title="Limpar hist√≥rico" style="flex:1 1 100px;">
            <span class="material-symbols-outlined">delete</span>
            LIMPAR
        </button>
        <button id="logoutBtn" class="control-btn control-logout" title="Sair" style="flex:1 1 100px;">
            <span class="material-symbols-outlined">logout</span>
            SAIR
        </button>
    </div>
  </div>
  
  <div class="card">
    <div class="analysis-wrapper">
      <div class="analysis-hot-cold" style="margin-top:5px;">
        <div class="suggestionTitle">
            <span class="material-symbols-outlined">thermometer</span>
            TEND√äNCIAS GERAIS
        </div>
        <div id="hotCold" class="suggestionBox">üî• Hot: -<br>‚ùÑÔ∏è Cold: -</div>
      </div>
    </div>
  </div>

  
  <input type="file" id="uploadPhoto" accept="image/*" class="hidden">
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ================== CONSTANTES DE CONFIGURA√á√ÉO ================== */
  // --- SENHA ALTERADA PARA 2025 ---
  const getPasswordHash = () => '2025'; 
  // ---------------------------------
  const BANKROLL_STORAGE_KEY = 'roletaIAPBankroll_main';
  const HISTORY_STORAGE_KEY = 'roletaIAPHistory'; 
  const CONFIG_STORAGE_KEY = 'roletaIAPConfig'; 
  
  const WHEEL_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
  const WHEEL_INDEX_MAP = {};
  WHEEL_ORDER.forEach((num, index) => { WHEEL_INDEX_MAP[num] = index; });

  const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36]);
  
  // Constantes de Stop Loss/Win/Sess√£o
  const STOP_LOSS_COUNT = 2; // 2 REDs consecutivos
  const STOP_LOSS_AMOUNT = 35.00; // R$35,00 de preju√≠zo total
  const STOP_WIN_COUNT = 3; // 3 WINs consecutivos
  const STOP_WIN_AMOUNT = 35.00; // R$35,00 de lucro total
  const LOCK_DURATION = 2 * 60 * 60 * 1000; // 2 horas em milis

  /* ================== VARI√ÅVEIS DE ESTADO ================== */
  let history = []; 
  let bankroll = { initial: 0, current: 0, profit: 0, wins: 0, losses: 0, totalBets: 0, streak: 0, lastResult: null, transactionHistory: [] };
  // Inicializa√ß√£o do estado, incluindo o novo padr√£o
  let config = { 
    currentPattern: 'zoneSuccession', // <-- Valor default para o seletor
    lockoutEndTime: 0 
  };
  let isLocked = false;
  let sessionStartTime = Date.now();
  let timerInterval;

  /* ================== FUN√á√ïES UTILI√ÅRIAS ================== */

  function getNumberColorClass(num) {
      if (num === 0) return 'zero';
      return RED_NUMBERS.has(num) ? 'red' : 'black';
  }

  function saveConfig() {
      localStorage.setItem(CONFIG_STORAGE_KEY, JSON.stringify(config));
  }

  function saveBankroll() {
      localStorage.setItem(BANKROLL_STORAGE_KEY, JSON.stringify(bankroll));
  }
  
  function saveHistory() {
      localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(history));
  }

  function loadState() {
      // Carregar Hist√≥rico
      const storedHistory = localStorage.getItem(HISTORY_STORAGE_KEY);
      if (storedHistory) {
          history = JSON.parse(storedHistory);
          renderHistory();
      }
      
      // Carregar Banca e Transa√ß√µes
      const storedBankroll = localStorage.getItem(BANKROLL_STORAGE_KEY);
      if (storedBankroll) {
          bankroll = JSON.parse(storedBankroll);
          renderDashboard();
          renderBankrollHistory();
      }

      // Carregar Configura√ß√µes (Padr√£o, Bloqueio)
      const storedConfig = localStorage.getItem(CONFIG_STORAGE_KEY);
      if (storedConfig) {
          // Garante que o objeto config est√° completo, mesclando o default com o salvo
          config = { ...config, ...JSON.parse(storedConfig) };
      }

      // Definir o seletor de padr√£o com o valor salvo
      const patternSelector = document.getElementById('patternSelector');
      if(patternSelector) {
        // Se a configura√ß√£o tiver um padr√£o salvo, usa ele
        patternSelector.value = config.currentPattern || 'zoneSuccession';
        // Define o nome do padr√£o ativo
        const selectedOption = patternSelector.options[patternSelector.selectedIndex];
        if (selectedOption) {
            document.getElementById('currentPatternName').textContent = selectedOption.text.split('(')[0].trim();
        }
      }

      // Verificar bloqueio
      checkLockoutStatus();
  }

  function checkLockoutStatus() {
      const now = Date.now();
      isLocked = config.lockoutEndTime > now;

      if (isLocked) {
          document.getElementById('lockScreen').classList.remove('hidden');
          document.getElementById('bodyTag').classList.add('login-active');
          updateLockoutTimer(config.lockoutEndTime);
      } else {
          document.getElementById('lockScreen').classList.add('hidden');
          document.getElementById('bodyTag').classList.remove('login-active');
      }
  }

  function startLockout(reason) {
      const now = Date.now();
      config.lockoutEndTime = now + LOCK_DURATION;
      saveConfig();
      document.getElementById('lockTitle').textContent = reason;
      document.getElementById('lockIcon').style.color = reason.includes('STOP WIN') ? 'var(--alert-green)' : 'var(--alert-red)';
      document.getElementById('lockScreen').classList.remove('hidden');
      document.getElementById('bodyTag').classList.add('login-active');
      updateBetSuggestion(history); // Atualiza a UI para refletir o bloqueio
      updateLockoutTimer(config.lockoutEndTime);
  }

  function updateLockoutTimer(endTime) {
      const timerElement = document.getElementById('countdownTimer');
      
      clearInterval(timerInterval); // Limpa qualquer intervalo anterior

      function updateTimer() {
          const now = Date.now();
          const remaining = endTime - now;

          if (remaining <= 0) {
              clearInterval(timerInterval);
              config.lockoutEndTime = 0;
              saveConfig();
              isLocked = false;
              checkLockoutStatus();
              updateBetSuggestion(history);
              return;
          }

          const hours = Math.floor(remaining / (1000 * 60 * 60));
          const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

          timerElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }

      updateTimer(); // Chama imediatamente para evitar delay
      timerInterval = setInterval(updateTimer, 1000);
  }
  
  function updateSessionTimer() {
      const now = Date.now();
      const elapsed = now - sessionStartTime;
      const hours = Math.floor(elapsed / (1000 * 60 * 60));
      const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
      document.getElementById('sessionTimer').textContent = `Sess√£o: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
  }

  /* ================== GEST√ÉO DE BANCA E TRANSA√á√ïES ================== */

  function setBankroll(initial) {
      if (initial <= 0) return alert("A banca inicial deve ser um valor positivo.");
      bankroll.initial = initial;
      bankroll.current = initial;
      bankroll.profit = 0;
      bankroll.wins = 0;
      bankroll.losses = 0;
      bankroll.totalBets = 0;
      bankroll.streak = 0;
      bankroll.lastResult = null;
      bankroll.transactionHistory = [];
      saveBankroll();
      renderDashboard();
      renderBankrollHistory();
  }

  function registerTransaction(amount, type) {
      if (bankroll.initial === 0) return alert("Defina a Banca Inicial primeiro.");
      if (amount <= 0) return alert("O valor da transa√ß√£o deve ser positivo.");
      
      bankroll.totalBets++;

      if (type === 'win') {
          bankroll.current += amount;
          bankroll.profit += amount;
          bankroll.wins++;
          bankroll.streak = bankroll.streak > 0 ? bankroll.streak + 1 : 1;
          bankroll.lastResult = 'win';
          bankroll.transactionHistory.unshift({ id: Date.now(), amount: amount, type: 'win', date: new Date().toLocaleTimeString() });
      } else if (type === 'loss') {
          bankroll.current -= amount;
          bankroll.profit -= amount;
          bankroll.losses++;
          bankroll.streak = bankroll.streak < 0 ? bankroll.streak - 1 : -1;
          bankroll.lastResult = 'loss';
          bankroll.transactionHistory.unshift({ id: Date.now(), amount: amount, type: 'loss', date: new Date().toLocaleTimeString() });
      } else {
          return;
      }

      // Limita o hist√≥rico de transa√ß√µes a 20 itens
      bankroll.transactionHistory = bankroll.transactionHistory.slice(0, 20);
      
      saveBankroll();
      renderDashboard();
      renderBankrollHistory();
      checkStopConditions();
  }

  function deleteTransaction(id) {
      const index = bankroll.transactionHistory.findIndex(t => t.id === id);
      if (index === -1) return;

      const transaction = bankroll.transactionHistory[index];
      
      // Reverter o impacto na banca e estat√≠sticas
      if (transaction.type === 'win') {
          bankroll.current -= transaction.amount;
          bankroll.profit -= transaction.amount;
          bankroll.wins--;
      } else if (transaction.type === 'loss') {
          bankroll.current += transaction.amount;
          bankroll.profit += transaction.amount;
          bankroll.losses--;
      }
      bankroll.totalBets--;

      // Remove a transa√ß√£o
      bankroll.transactionHistory.splice(index, 1);
      
      // Recalcula a streak (simplificado, pode n√£o ser 100% preciso ap√≥s exclus√£o)
      bankroll.streak = bankroll.lastResult === 'win' ? bankroll.wins : -bankroll.losses; 
      
      saveBankroll();
      renderDashboard();
      renderBankrollHistory();
      checkStopConditions(); 
  }

  function checkStopConditions() {
      // 1. Stop Win (Consecutivo)
      if (bankroll.streak >= STOP_WIN_COUNT) {
          startLockout(`ZONA SEGURA ATINGIDA (STOP WIN de ${STOP_WIN_COUNT} Greens)`);
          return;
      }
      // 2. Stop Loss (Consecutivo)
      if (bankroll.streak <= -STOP_LOSS_COUNT) {
          startLockout(`ZONA SEGURA ATINGIDA (STOP LOSS de ${STOP_LOSS_COUNT} Reds)`);
          return;
      }
      // 3. Stop Win (Financeiro)
      if (bankroll.profit >= STOP_WIN_AMOUNT) {
          startLockout(`ZONA SEGURA ATINGIDA (STOP WIN Financeiro: +R$${STOP_WIN_AMOUNT.toFixed(2)})`);
          return;
      }
      // 4. Stop Loss (Financeiro)
      if (bankroll.profit <= -STOP_LOSS_AMOUNT) {
          startLockout(`ZONA SEGURA ATINGIDA (STOP LOSS Financeiro: -R$${STOP_LOSS_AMOUNT.toFixed(2)})`);
          return;
      }
  }

  /* ================== AN√ÅLISE DE PADR√ïES ================== */

  // Fun√ß√£o gen√©rica para contar sucessores (utilizada por ambos os padr√µes)
  function getSuccessorDetails(targetNumber, history) {
      const MAX_LOOKBACK = 100;
      // history[0] √© o n√∫mero mais recente. O gatilho √© analisado sobre o restante.
      const historyToAnalyze = history.slice(1, MAX_LOOKBACK + 1); 
      const successorsMap = {};

      for (let i = 0; i < historyToAnalyze.length; i++) {
          // Se o n√∫mero anterior (historyToAnalyze[i]) √© o gatilho (targetNumber)
          if (historyToAnalyze[i] === targetNumber && i > 0) {
              // O sucessor √© o n√∫mero que veio AP√ìS a ocorr√™ncia do gatilho (historyToAnalyze[i - 1])
              const successor = historyToAnalyze[i - 1]; 
              successorsMap[successor] = (successorsMap[successor] || 0) + 1;
          }
      }

      const sortedSuccessors = Object.entries(successorsMap)
          .sort(([, a], [, b]) => b - a)
          .map(([num, count]) => ({ num: parseInt(num), count }));
      
      return sortedSuccessors;
  }
  
  function getZoneNeighbors(num) {
      if (num === 0) return [0, 3, 26, 32, 15, 19, 4]; // Voisins + 0
      const index = WHEEL_INDEX_MAP[num];
      const neighbors = [];
      // 5 vizinhos: 2 para cada lado + o pr√≥prio n√∫mero
      for (let i = -2; i <= 2; i++) {
          let neighborIndex = (index + i + WHEEL_ORDER.length) % WHEEL_ORDER.length;
          neighbors.push(WHEEL_ORDER[neighborIndex]);
      }
      return neighbors;
  }
  
  // Fun√ß√£o de Sugest√£o de ZONA 5
  function getZoneSuccessionSuggestion(lastNumber, history) {
      const successors = getSuccessorDetails(lastNumber, history);
      const neighbors = getZoneNeighbors(lastNumber);
      const ZONE_THRESHOLD = 2; // M√≠nimo de 2 sucess√µes para ser relevante

      let totalSuccessions = 0;
      let zoneSuccessions = 0;

      const analysisLines = [];

      successors.forEach(({ num, count }) => {
          totalSuccessions += count;
          const isNeighbor = neighbors.includes(num);
          const colorClass = getNumberColorClass(num);

          if (isNeighbor && count >= 1) { // Conta todos os vizinhos para o hist√≥rico
              if (count >= ZONE_THRESHOLD) {
                zoneSuccessions += count;
                analysisLines.push(`- **ZONA (Hot):** <span class="chip ${colorClass}">${num}</span>: **${count}x**`);
              } else {
                analysisLines.push(`- ZONA (Cold): <span class="chip ${colorClass}">${num}</span>: ${count}x`);
              }
          } else if (!isNeighbor && count >= 1) {
              analysisLines.push(`- Fora: <span class="chip ${colorClass}">${num}</span>: ${count}x`);
          }
      });
      
      let analysisOutput = `Gatilho: <span class="chip ${getNumberColorClass(lastNumber)}">${lastNumber}</span>. Zona de Vizinhos (5): ${neighbors.join(', ')}.`;
      analysisOutput += `<div class="data-separator"></div>**Frequ√™ncia na Zona de Vizinhos:**`;

      if (analysisLines.length > 0) {
          analysisOutput += `<br>${analysisLines.join('<br>')}`;
      } else {
          analysisOutput += `<br>Nenhuma sucess√£o encontrada no hist√≥rico para o Gatilho ${lastNumber}.`;
      }
      
      // Sugerir os vizinhos que mais ca√≠ram como sucessores, ou a pr√≥pria Zona se for forte.
      const topZoneSuccessors = successors
          .filter(s => neighbors.includes(s.num))
          .sort((a, b) => b.count - a.count)
          .slice(0, 5) // Pega os 5 vizinhos mais frequentes
          .map(s => s.num);

      return {
          suggestion: topZoneSuccessors.length > 0 ? topZoneSuccessors : neighbors.filter(n => n !== lastNumber).slice(0, 5), // Se n√£o houver sucessores, sugere os 5 vizinhos mais pr√≥ximos (excluindo o pr√≥prio gatilho)
          analysisOutput: analysisOutput,
          isEntryValid: true, // ZONA 5 n√£o usa valida√ß√£o de quebra, a entrada √© sempre liberada
          validationMessage: ''
      };
  }
  
  /* ================== PADR√ÉO: 4 SUCESSORES (NOVO - L√ìGICA DE QUEBRA) ================== */

  function getFourSuccessorsSuggestion(history) {
      // √â necess√°rio pelo menos 2 n√∫meros (Valida√ß√£o no 0, Gatilho no 1)
      if (history.length < 2) {
          return { 
              suggestion: [], 
              analysisOutput: `Aguardando mais dados. Padr√£o "4 Sucessores" precisa de pelo menos 2 n√∫meros para definir o gatilho.`,
              isEntryValid: false,
              validationMessage: 'Hist√≥rico insuficiente para definir o Gatilho e a Zona de Aposta.'
          };
      }

      const TARGET_TRIGGER = history[1]; // O GATILHO √© o pen√∫ltimo n√∫mero
      const CURRENT_NUMBER = history[0]; // O n√∫mero atual (√∫ltimo que caiu) √© a valida√ß√£o
      
      const SUCCESSORS_TO_COLLECT = 4;
      const LOOKBACK_COUNT = 100; // Analisar todo o hist√≥rico para sucessores

      // Obt√©m o detalhe dos sucessores do TARGET_TRIGGER
      const sortedSuccessorsDetails = getSuccessorDetails(TARGET_TRIGGER, history);
      const totalSuccessorsCount = sortedSuccessorsDetails.reduce((sum, s) => sum + s.count, 0);

      // Pega os 4 mais frequentes (Zona de Bloqueio/Aposta)
      const sortedSuccessors = sortedSuccessorsDetails
          .slice(0, SUCCESSORS_TO_COLLECT)
          .map(s => s.num); 

      // 1. L√≥gica de Valida√ß√£o da Entrada
      let isEntryValid = false;
      let validationMessage = '';

      if (totalSuccessorsCount === 0) {
           isEntryValid = false;
           validationMessage = `O n√∫mero **${TARGET_TRIGGER}** (Gatilho) ainda n√£o caiu no hist√≥rico anterior para an√°lise de sucessores.`;
      } else if (sortedSuccessors.length < SUCCESSORS_TO_COLLECT) {
          // Se n√£o houver 4 sucessores distintos
          isEntryValid = false;
          validationMessage = `Aguardando mais dados. Encontrei apenas ${sortedSuccessors.length} sucessor(es) distinto(s) para o Gatilho **${TARGET_TRIGGER}**.`;
      } else if (sortedSuccessors.includes(CURRENT_NUMBER)) {
          // Se o n√∫mero atual (0) *CAIU* na zona dos 4 sucessores, a entrada √© BLOQUEADA
          isEntryValid = false;
          validationMessage = `AGUARDANDO QUEBRA: O √∫ltimo n√∫mero **${CURRENT_NUMBER}** (Valida√ß√£o) CAIU em um dos 4 Sucessores. Pr√≥ximo giro aguarda um n√∫mero FORA desta Zona.`;
      } else {
          // Se o n√∫mero atual (0) *N√ÉO CAIU* na zona, a entrada √© LIBERADA
          isEntryValid = true;
          validationMessage = `QUEBRA DE PADR√ÉO: O √∫ltimo n√∫mero **${CURRENT_NUMBER}** (Valida√ß√£o) CAIU **FORA** da Zona de Sucessores. Entrada liberada!`;
      }


      // 2. Gerar a sa√≠da da an√°lise detalhada (Formatado conforme o pedido)
      let analysisText = `
          <div class="pattern-line" style="font-size: 16px;">
              **Gatilho Ativo:** <span class="chip ${getNumberColorClass(TARGET_TRIGGER)}">${TARGET_TRIGGER}</span>
              <span style="font-size:12px;color:var(--muted);margin-left:10px;">(Sucess√µes encontradas: ${totalSuccessorsCount}x)</span>
          </div>
          <div class="pattern-line" style="font-size: 16px; margin-top: 10px;">
              **Valida√ß√£o (√öltimo Giro):** <span class="chip ${getNumberColorClass(CURRENT_NUMBER)}">${CURRENT_NUMBER}</span>
          </div>
      `;
      
      analysisText += `<div class="data-separator"></div>`;

      // Renderizar a valida√ß√£o em destaque (Emojis e texto)
      const validationStatusHTML = isEntryValid && sortedSuccessors.length === SUCCESSORS_TO_COLLECT
          ? `<div class="pattern-trigger" style="color:var(--alert-green); font-size: 18px;">‚úÖ ENTRADA LIBERADA!</div>`
          : `<div class="pattern-trigger" style="color:var(--zero); font-size: 18px;">‚è≥ ${validationMessage.includes('QUEBRA') ? 'ENTRADA LIBERADA (Erro ao contar 4 Sucessores)' : 'AGUARDANDO QUEBRA...'}</div>`;
      
      analysisText += validationStatusHTML;

      analysisText += `<div style="font-size: 14px; margin-top: 5px; color: ${isEntryValid ? 'var(--alert-green)' : 'var(--zero)'};">${validationMessage}</div>`;
      
      analysisText += `<div class="data-separator"></div>`;

      analysisText += `<div class="pattern-line">**Os 4 Sucessores (Zona de Bloqueio/Aposta):**</div>`;

      // Renderizar todos os sucessores contados
      sortedSuccessorsDetails.forEach(s => {
          const num = s.num;
          const count = s.count;
          const colorClass = getNumberColorClass(num);
          const isTopFour = sortedSuccessors.includes(num);
          const percentage = totalSuccessorsCount > 0 ? (count / totalSuccessorsCount * 100).toFixed(1) : 0;
          
          analysisText += `<div class="pattern-line">  - ${isTopFour ? 'üéØ' : ''} N√∫mero <span class="chip ${colorClass}">${num}</span>: **${count}x** (${percentage}%)</div>`;
      });
      
      analysisText += `<div class="data-separator"></div>`;
      
      // A sugest√£o de aposta √© sempre nos 4 sucessores (quando liberado)
      if (sortedSuccessors.length === SUCCESSORS_TO_COLLECT) {
          analysisText += `<div class="pattern-line">**üî• ZONA DE APOSTA:** <span class="pattern-succession">${sortedSuccessors.join(', ')}</span></div>`;
      } else {
          analysisText += `<div class="pattern-line">**üî• ZONA DE APOSTA:** <span class="pattern-succession">Aguardando 4 sucessores para definir a Zona.</span></div>`;
      }

      return {
          suggestion: sortedSuccessors, 
          analysisOutput: analysisText,
          isEntryValid: isEntryValid,
          validationMessage: validationMessage
      };
  }
  
  /* ================== RENDERIZA√á√ÉO DA UI ================== */

  function renderNumberGrid() {
      const grid = document.getElementById('gridNumbers');
      grid.innerHTML = '';
      WHEEL_ORDER.forEach(num => {
          const btn = document.createElement('button');
          btn.textContent = num;
          btn.classList.add('number-btn', getNumberColorClass(num));
          btn.addEventListener('click', () => addNumberToHistory(num));
          grid.appendChild(btn);
      });
  }

  function renderHistory() {
      const historyElement = document.getElementById('history');
      historyElement.innerHTML = '';
      document.getElementById('historyCount').textContent = `${history.length}/100`;

      history.forEach((num, index) => {
          const chip = document.createElement('div');
          chip.textContent = num;
          chip.classList.add('chip', getNumberColorClass(num));
          chip.setAttribute('title', `Clique para remover o n√∫mero ${num}`);
          chip.addEventListener('click', () => removeNumberFromHistory(index));
          historyElement.appendChild(chip);
      });
      
      // Garante que o scroll est√° no in√≠cio (n√∫meros mais recentes)
      historyElement.scrollLeft = 0;

      // Ap√≥s renderizar o hist√≥rico, atualiza a sugest√£o
      updateBetSuggestion(history);
  }

  function renderDashboard() {
      const dashboard = document.getElementById('performanceDashboard');
      const profitClass = bankroll.profit >= 0 ? 'positive' : 'negative';
      const streakText = bankroll.streak > 0 ? `+${bankroll.streak}` : bankroll.streak;
      const streakClass = bankroll.streak > 0 ? 'positive' : (bankroll.streak < 0 ? 'negative' : '');
      
      const stats = `
          <div class="stat-item">
              <div class="stat-title">BANCA ATUAL</div>
              <div class="stat-value">R$${bankroll.current.toFixed(2)}</div>
          </div>
          <div class="stat-item">
              <div class="stat-title">LUCRO/PREJU√çZO</div>
              <div class="stat-value ${profitClass}">R$${bankroll.profit.toFixed(2)}</div>
          </div>
          <div class="stat-item">
              <div class="stat-title">WINS | LOSSES</div>
              <div class="stat-value">${bankroll.wins} | ${bankroll.losses}</div>
          </div>
          <div class="stat-item">
              <div class="stat-title">STREAK</div>
              <div class="stat-value ${streakClass}">${streakText}</div>
          </div>
      `;
      dashboard.innerHTML = stats;
  }

  function renderBankrollHistory() {
      const historyList = document.getElementById('bankrollHistory');
      historyList.innerHTML = '';

      if (bankroll.transactionHistory.length === 0) {
          historyList.innerHTML = '<div class="log-item log-placeholder">Nenhum registro ainda.</div>';
          return;
      }

      bankroll.transactionHistory.forEach(t => {
          const item = document.createElement('div');
          item.classList.add('log-item', t.type === 'win' ? 'log-win' : 'log-loss');
          item.innerHTML = `
              <span>${t.date} | ${t.type.toUpperCase()} | R$${t.amount.toFixed(2)}</span>
              <button class="log-delete-btn" data-id="${t.id}" title="Remover transa√ß√£o">X</button>
          `;
          historyList.appendChild(item);
      });

      // Adicionar listeners para os bot√µes de exclus√£o
      historyList.querySelectorAll('.log-delete-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
              const id = parseInt(e.target.dataset.id);
              if (confirm("Tem certeza que deseja remover esta transa√ß√£o?")) {
                 deleteTransaction(id);
              }
          });
      });
  }

  function updateHotCold(history) {
      const MAX_LOOKBACK = 50; 
      const historySlice = history.slice(0, MAX_LOOKBACK);
      const counts = {};
      WHEEL_ORDER.forEach(num => counts[num] = 0);
      historySlice.forEach(num => counts[num] = (counts[num] || 0) + 1);

      const sorted = Object.entries(counts).sort(([, a], [, b]) => b - a);
      
      const hotNumbers = sorted.slice(0, 5).map(([num, count]) => `${num} (${count}x)`).join(', ');
      const coldNumbers = sorted.slice(-5).map(([num, count]) => `${num} (${count}x)`).join(', ');

      document.getElementById('hotCold').innerHTML = `üî• Hot: ${hotNumbers}<br>‚ùÑÔ∏è Cold: ${coldNumbers}`;
  }


  /* ================== FUN√á√ÉO DE CONTROLE PRINCIPAL: ATUALIZA BOOSTER E AN√ÅLISE (MODIFICADA) ================== */

  function updateBetSuggestion(history) {
      const pattern = config.currentPattern;
      const betSuggestionElement = document.getElementById('betSuggestion');
      // Novo ID para an√°lise detalhada
      const patternAnalysisOutput = document.getElementById('patternAnalysisOutput'); 
      const currentPatternNameElement = document.getElementById('currentPatternName');

      // 1. Verificar Status de Bloqueio
      if (isLocked) {
          betSuggestionElement.innerHTML = `<span style="color:var(--muted)">Aguardando dados ou aguardando desbloqueio...</span>`;
          patternAnalysisOutput.innerHTML = `An√°lise bloqueada. Retorne ap√≥s o per√≠odo de resfriamento.`;
          return;
      }

      // 2. Verificar M√≠nimo de Hist√≥rico
      if (history.length < 1) {
          betSuggestionElement.innerHTML = `<span style="color:var(--muted)">Adicione o primeiro n√∫mero para iniciar a an√°lise.</span>`;
          patternAnalysisOutput.innerHTML = `Adicione n√∫meros ao hist√≥rico para ver a an√°lise detalhada.`;
          const selector = document.getElementById('patternSelector');
          if (selector && selector.selectedIndex !== -1) {
             currentPatternNameElement.textContent = selector.options[selector.selectedIndex].text.split('(')[0].trim();
          }
          updateHotCold(history); // Atualiza Hot/Cold mesmo com pouco hist√≥rico
          return;
      }

      const lastNumber = history[0];
      let result = { suggestion: [], analysisOutput: 'Nenhuma an√°lise dispon√≠vel para este padr√£o.', isEntryValid: false, validationMessage: '' };

      // Atualiza o nome do padr√£o no Booster
      const selector = document.getElementById('patternSelector');
      if (selector && selector.selectedIndex !== -1) {
        currentPatternNameElement.textContent = selector.options[selector.selectedIndex].text.split('(')[0].trim();
      }


      // 3. Executar o Padr√£o Selecionado
      if (pattern === 'zoneSuccession') {
          result = getZoneSuccessionSuggestion(lastNumber, history);
          
      } else if (pattern === 'fourSuccessors') {
          result = getFourSuccessorsSuggestion(history);
      } 

      // 4. Atualizar a UI
      patternAnalysisOutput.innerHTML = result.analysisOutput;
      
      const isFourSuccessorsActive = pattern === 'fourSuccessors';
      const isReadyToSuggest = result.suggestion && result.suggestion.length > 0;
      
      const triggerDisplay = (isFourSuccessorsActive && history.length >= 2) ? history[1] : lastNumber; 
      const triggerChip = `<span class="chip ${getNumberColorClass(triggerDisplay)}">${triggerDisplay}</span>`;


      // 5. Renderiza√ß√£o do Booster
      if (isReadyToSuggest) {
          const suggestionChips = result.suggestion.map(num => {
              const colorClass = getNumberColorClass(num);
              return `<div class="chip ${colorClass}">${num}</div>`;
          }).join('');
          
          let entryStatus;
          if (isFourSuccessorsActive) {
            entryStatus = result.isEntryValid && result.suggestion.length === 4
              ? `<span style="font-weight:700; color:var(--alert-green);">ENTRADA LIBERADA! ‚úÖ</span>`
              : `<span style="font-weight:700; color:var(--zero);">AGUARDANDO QUEBRA... ‚è≥</span>`;
          } else {
            // Zona 5 n√£o tem status de quebra de padr√£o, a entrada √© sempre liberada
            entryStatus = `<span style="font-weight:700; color:var(--accent-secondary);">ANALISANDO ZONA...</span>`;
          }

          // Conte√∫do do Booster de Aposta
          betSuggestionElement.innerHTML = `
              <div style="font-size:14px;color:var(--black);margin-bottom:8px;">
                  **Gatilho:** ${triggerChip}
              </div>
              <div style="font-size:18px; color:var(--black); margin-bottom: 10px;">
                  **STATUS:** ${entryStatus}
              </div>
              <div style="display:flex; flex-wrap:wrap; gap:10px; border-top: 1px dashed var(--muted); padding-top: 10px;">
                  ${suggestionChips}
              </div>
          `;
      } else {
          // Caso de bloqueio do 4 Sucessores ou Hist√≥rico Insuficiente
          const statusText = isFourSuccessorsActive && history.length >= 2 
            ? `**STATUS: AGUARDANDO PADR√ÉO.**` 
            : `**STATUS: AGUARDANDO DADOS.**`;

          betSuggestionElement.innerHTML = `
            <div style="font-size:14px;color:var(--black);margin-bottom:8px;">
                  **Gatilho:** ${history.length >= 2 ? triggerChip : '-'}
            </div>
            <div style="font-size:18px; color:var(--alert-red); margin-bottom: 10px;">
              ‚õî ${statusText}
            </div>
            <div style="font-size:14px; color:var(--muted);">${result.validationMessage || 'Sem sugest√£o. Hist√≥rico insuficiente.'}</div>
          `;
      }

      updateHotCold(history);
  }

  /* ================== GEST√ÉO DE HIST√ìRICO ================== */

  function addNumberToHistory(num) {
      if (isLocked) {
          alert("O sistema est√° bloqueado (Zona Segura). Pule o bloqueio para continuar.");
          return;
      }
      history.unshift(num);
      if (history.length > 100) {
          history.pop();
      }
      saveHistory();
      renderHistory();
  }

  function removeNumberFromHistory(index) {
      history.splice(index, 1);
      saveHistory();
      renderHistory();
  }

  function clearHistory() {
      if (confirm("Tem certeza que deseja limpar todo o hist√≥rico?")) {
          history = [];
          saveHistory();
          renderHistory();
      }
  }


  /* ================== INICIALIZA√á√ÉO ================== */

  // Iniciar rel√≥gio
  setInterval(() => {
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString();
      updateSessionTimer();
  }, 1000);

  // Listeners de Login
  document.getElementById('btnSignInReal').addEventListener('click', () => {
      const pwd = document.getElementById('authPwd').value;
      if (pwd === getPasswordHash()) {
          document.getElementById('loginScreen').classList.add('hidden');
          document.getElementById('mainPanel').classList.remove('hidden');
          document.getElementById('bodyTag').classList.remove('login-active');
          sessionStartTime = Date.now();
          // Certifica-se que o timer de bloqueio est√° ativo se houver um
          checkLockoutStatus(); 
      } else {
          alert("Senha incorreta para o Modo Real.");
      }
  });

  document.getElementById('btnSignInDemo').addEventListener('click', () => {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainPanel').classList.remove('hidden');
      document.getElementById('bodyTag').classList.remove('login-active');
      sessionStartTime = Date.now();
      checkLockoutStatus();
  });

  // Listener do bot√£o de logout
  document.getElementById('logoutBtn').addEventListener('click', () => {
      document.getElementById('mainPanel').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('bodyTag').classList.add('login-active');
      // Resetar input de senha
      document.getElementById('authPwd').value = '';
  });

  // Listeners de Banca
  document.getElementById('btnSetBankroll').addEventListener('click', () => {
      const initial = parseFloat(document.getElementById('initialBankrollInput').value);
      if (!isNaN(initial) && initial > 0) {
          setBankroll(initial);
      } else {
          alert("Insira um valor de banca inicial v√°lido.");
      }
  });
  
  document.getElementById('btnRegisterWin').addEventListener('click', () => {
      const amount = parseFloat(document.getElementById('betAmountInput').value);
      if (!isNaN(amount) && amount > 0) {
          registerTransaction(amount, 'win');
          document.getElementById('betAmountInput').value = ''; // Limpa o campo
      } else {
          alert("Insira um valor ganho v√°lido.");
      }
  });

  document.getElementById('btnRegisterLoss').addEventListener('click', () => {
      const amount = parseFloat(document.getElementById('betAmountInput').value);
      if (!isNaN(amount) && amount > 0) {
          registerTransaction(amount, 'loss');
          document.getElementById('betAmountInput').value = ''; // Limpa o campo
      } else {
          alert("Insira um valor perdido v√°lido.");
      }
  });

  // Listener de Limpar Hist√≥rico
  document.getElementById('clearBtn').addEventListener('click', clearHistory);

  // Listener do bot√£o de pular bloqueio
  document.getElementById('btnSkipLock').addEventListener('click', () => {
      if (confirm("ATEN√á√ÉO: Quebrar a regra pode comprometer sua gest√£o de risco. Deseja realmente pular o bloqueio?")) {
          clearInterval(timerInterval);
          config.lockoutEndTime = 0;
          saveConfig();
          isLocked = false;
          checkLockoutStatus();
      }
  });
  
  // NOVO: Seletor de Padr√µes Listener
  const patternSelector = document.getElementById('patternSelector');
  if (patternSelector) {
      patternSelector.addEventListener('change', (e) => {
          config.currentPattern = e.target.value;
          saveConfig();
          updateBetSuggestion(history); // Recalcula a sugest√£o com o novo padr√£o
      });
  }

  // Inicializa√ß√£o
  loadState();
  renderNumberGrid();
});
</script>
</body>
</html>
