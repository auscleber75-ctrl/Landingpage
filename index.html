<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROLETA IAP BRASIL üáßüá∑</title>

<link rel="manifest" href="manifest.webmanifest">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Passion+One:wght@400;700&family=Roboto:wght@400;700&display=swap" />

<style>
/* ================== CONFIGURA√á√ÉO DE CORES E FONTES (TROPICAL BRASIL) ================== */

:root{
  --bg:#E0F7FA; /* Fundo Azul Claro (C√©u/Mar) */
  --panel:#FFFFFF; /* Fundo do Card (Branco/Areia Clara) */
  --accent:#FFC300; /* Amarelo Ouro/Sol (Acento Principal) */
  --accent-secondary:#0079C0; /* Azul do Mar (Acento Secund√°rio) */
  --muted:#555555; /* Cinza Escuro Suave (Texto Comum) */
  --zero:#FF8C00; /* Laranja Forte/Gold (Zero) */
  --red:#B70404; /* Vermelho Vibrante */
  --black:#17202A; /* Azul Escuro/Carv√£o (Para n√∫meros e inputs) */
  --btn-main:linear-gradient(90deg, var(--accent), var(--accent-secondary)); 
  --alert-red:#D83C3C;
  --alert-green:#00A859; /* Verde Bandeira */
  --lock-bg:rgba(255, 255, 255, 0.95); /* Bloqueio Claro com Blur */

  --status-pending: #FFC300; /* Laranja para Pendente */
  --status-success: var(--alert-green); /* Verde para Sucesso */
  --status-fail: var(--alert-red); /* Vermelho para Falha */
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Roboto',sans-serif; /* Fonte mais clean para leitura */
  background:var(--bg);
  color:#17202A; /* Texto escuro no fundo claro */
  padding:14px;
}
.hidden { display: none !important; }

/* Corre√ß√£o da Tela de Login: impede rolagem */
body.login-active {
    height: 100vh;
    overflow: hidden;
}

/* ================== TELA DE LOGIN ================== */
#loginScreen {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    position: fixed; 
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    z-index: 8000; 
}
#loginBox {
    background: var(--panel);
    border-radius: 12px;
    padding: 30px;
    max-width: 400px;
    width: 100%;
    /* Novo Box Shadow mais tropical */
    box-shadow: 0 0 40px rgba(0, 121, 192, 0.1), 0 5px 15px rgba(0,0,0,0.1); 
    border: 1px solid rgba(0, 121, 192, 0.2);
    text-align: center;
}
.login-title{
    font-family:'Passion One', cursive; /* Fonte vibrante para t√≠tulos */
    font-weight: 700;
    font-size: 32px;
    color: var(--accent);
    margin-bottom: 5px;
    text-shadow: 0 0 5px rgba(255, 195, 0, 0.5);
}
.login-subtitle {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 25px;
}
#authPwd{
    width: 100%;
    padding: 12px;
    background: #F0F0F0; /* Fundo do input mais claro */
    border: 1px solid var(--accent-secondary);
    border-radius: 6px;
    color: var(--black);
    font-family: 'Roboto', sans-serif; /* Mantido como leitura */
    font-size: 16px;
    transition: border-color 0.2s, box-shadow 0.2s;
    margin-top: 15px;
}
#authPwd:focus {
    outline: none;
    border-color: var(--zero);
    box-shadow: 0 0 10px rgba(255,140,0,0.5);
    background: #fff;
}

/* ================== LAYOUT E COMPONENTES MODERNOS ================== */

/* Header / clock */
.header{
  /* Novo gradiente de Mar e Sol */
  background: linear-gradient(90deg, rgba(255,195,0,0.2), rgba(0,121,192,0.1)); 
  border-radius:8px; 
  padding:12px; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  box-shadow:0 0 15px rgba(0,0,0,0.1);
  border: 1px solid rgba(0,121,192,0.1);
}
.title{
  font-family:'Passion One', cursive;
  font-weight:700;
  font-size:24px;
  color: var(--accent-secondary); /* T√≠tulo em Azul do Mar */
  text-shadow: 0 0 5px rgba(0, 121, 192, 0.5);
}
#clock{
  color:var(--zero);
  font-family:'Passion One', cursive;
  font-weight:700;
  text-shadow:0 0 8px rgba(255,140,0,0.5);
}
#sessionTimer{
    font-size: 10px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    margin-left: 10px;
}

/* card */
.card{
  background:var(--panel);
  border-radius:12px;
  padding:15px;
  margin-top:14px;
  /* Sombra mais suave */
  box-shadow:0 5px 20px rgba(0,0,0,0.1), inset 0 0 8px rgba(0,121,192,0.05); 
  border:1px solid rgba(0,121,192,0.1);
  transition: all 0.3s ease;
}

/* T√≠tulos / Sugest√µes */
.suggestionTitle{
  font-family:'Passion One', cursive;
  font-weight:700;
  color:var(--accent); /* T√≠tulos em Amarelo Sol */
  margin-bottom:8px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 1px dashed rgba(0, 121, 192, 0.3);
  padding-bottom: 5px;
}
.suggestionBox{
  font-size:15px;
  color:var(--black); /* Texto escuro */
  line-height:1.7;
}
.iaGlow{
  color:var(--accent-secondary); /* Cor secund√°ria para o Booster */
  text-shadow:0 0 10px rgba(0, 121, 192, 0.6);
  /* Brilho mais suave */
  animation:glowPulse 2s infinite alternate;
}
@keyframes glowPulse{
  0%{text-shadow:0 0 3px rgba(0, 121, 192, 0.2)}
  100%{text-shadow:0 0 10px rgba(0, 121, 192, 0.8)}
}

.data-separator {
  height: 1px;
  /* Gradiente de Sol para Mar */
  background: linear-gradient(90deg, var(--accent), var(--accent-secondary), rgba(0,0,0,0));
  margin: 12px 0;
  opacity: 0.7;
}

/* ================== BOT√ïES E INPUTS ================== */

/* grid numbers */
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
  gap:8px;
  justify-content:center;
  margin-top: 10px;
}
.number-btn{
  width:100%; height:45px;
  border-radius:8px;
  border:1px solid rgba(0, 0, 0, 0.1);
  font-family:'Passion One', cursive;
  font-weight:700;
  cursor:pointer;
  transition:transform .14s,box-shadow .14s, border-color 0.14s;
  color: var(--black); /* Texto escuro */
}
.number-btn:hover{
    transform:scale(1.05); 
    box-shadow:0 0 15px rgba(0,121,192,0.4);
    border-color: var(--accent-secondary);
}
.number-btn:active{transform:scale(0.95); }
.red{background:var(--red);color:#fff}
.black{background:var(--black);color:#fff}
.zero, .green {background:var(--zero);color:var(--black)} 

/* Bot√µes de controle */
.control-btn{
  background:var(--btn-main);
  border:0;
  border-radius:6px;
  padding:12px 14px;
  color:#fff; /* Texto branco no gradiente */
  font-weight:700;
  font-family:'Passion One', cursive;
  cursor:pointer;
  transition: all .2s;
  margin: 4px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  text-transform: uppercase;
  display: flex; /* Para alinhar o √≠cone */
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.control-btn:hover{
    opacity:0.95; 
    box-shadow: 0 0 15px rgba(255,195,0,0.8);
    transform: translateY(-2px);
}
.control-btn:active{transform: translateY(1px);}
.control-btn:disabled { 
    opacity: 0.3; 
    cursor: not-allowed; 
    box-shadow: none; 
}


.btn-win { background: var(--alert-green); color: #fff; }
.btn-loss { background: var(--alert-red); color: #fff; }

/* Estilos de Entrada (Input) */
.bankroll-label {
    font-size: 11px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    margin-bottom: 4px;
    margin-top: 8px;
}
.bankroll-input {
    width: 100%;
    padding: 10px;
    background: #F0F8FF; /* Fundo do input mais claro */
    border: 1px solid var(--accent-secondary);
    border-radius: 6px;
    color: var(--black);
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    transition: border-color 0.2s;
}
.bankroll-input:focus {
    outline: none;
    border-color: var(--zero);
    box-shadow: 0 0 8px rgba(255,140,0,0.5);
    background: #fff;
}

/* ================== AN√ÅLISE E DASHBOARD DE BANCA ================== */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;
    margin-top: 10px;
    padding-top: 10px;
}
.stat-item {
    background: #F0F8FF; /* Fundo do stat item mais suave */
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid var(--accent-secondary);
    box-shadow: inset 0 0 5px rgba(0, 121, 192, 0.1);
}
.stat-title {
    font-size: 11px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    margin-bottom: 5px;
}
.stat-value {
    font-size: 18px;
    font-weight: 700;
    font-family: 'Passion One', cursive;
    color: var(--black);
}
.positive { color: var(--alert-green) !important; text-shadow: 0 0 3px rgba(0, 168, 89, 0.5);}
.negative { color: var(--alert-red) !important; text-shadow: 0 0 3px rgba(216, 60, 60, 0.5);}

/* Hist√≥ria de Padr√µes (Chips) - ALTERADO PARA LINHA √öNICA */
.history{
    display: flex;
    flex-wrap: nowrap;
    gap: 8px;
    margin-top: 10px;
    max-width: 100%;
    overflow-x: auto;
    padding: 8px 5px;
    background: rgba(0,0,0,0.1); /* Fundo da hist√≥ria mais claro */
    border-radius: 6px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; 
}
.history::-webkit-scrollbar {
    display: none; 
}
.chip{
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.2);
    transition: transform 0.1s;
    font-family: 'Passion One', cursive;
}
.chip:hover { transform: scale(1.15); box-shadow: 0 0 10px var(--accent-secondary);}
.chip.zero { background: var(--zero); color: var(--black); }
.chip.red { background: var(--red); color: #fff; }
.chip.black { background: var(--black); color: #fff; border-color: rgba(255,255,255,0.5);}

/* An√°lise de Padr√µes/Tabela */
.analysis-output {
    background: #F0F8FF; 
    border: 1px solid var(--accent-secondary);
    border-radius: 8px;
    padding: 12px;
    box-shadow: inset 0 0 5px rgba(0, 121, 192, 0.1);
}
.pattern-line {
    font-size: 14px;
    margin-bottom: 6px;
    line-height: 1.4;
    color: var(--black);
}
.pattern-trigger {
    color: var(--zero);
    font-weight: bold;
    font-family: 'Passion One', cursive;
}
.pattern-succession {
    color: var(--accent);
    font-weight: bold;
}
.pattern-count {
    color: var(--muted);
    font-size: 12px;
}

/* Extrato */
#bankrollHistory {
    max-height: 150px;
    overflow-y: auto;
    padding: 5px;
    background: rgba(0,0,0,0.1); 
    border-radius: 6px;
}
.log-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    margin-bottom: 4px;
    border-radius: 4px;
    font-size: 14px;
    transition: background 0.2s;
}
.log-win { background: rgba(0, 168, 89, 0.1); border-left: 3px solid var(--alert-green); color: var(--alert-green);}
.log-loss { background: rgba(216, 60, 60, 0.1); border-left: 3px solid var(--alert-red); color: var(--alert-red);}
.log-delete-btn {
    background: none;
    border: none;
    color: var(--muted);
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s;
}
.log-delete-btn:hover { color: var(--black); }

/* ================== TELA DE BLOQUEIO (CADEADO) ================== */

#lockScreen{
  position:fixed;
  inset:0;
  background:var(--lock-bg);
  backdrop-filter: blur(6px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9000;
  text-align:center;
}
#lockScreen svg {
    color: var(--alert-red);
    margin-bottom: 10px;
}
#lockScreen h2{
  font-family:'Passion One', cursive;
  color:var(--alert-red);
  font-size:32px;
}
#lockScreen h2.win {
  color:var(--alert-green);
}
#lockScreen p{
  font-size:18px;
  color:var(--muted);
  margin-top: 10px;
}
#lockScreen .countdown{
  font-family:'Passion One', cursive;
  font-size:52px;
  font-weight:700;
  color:var(--accent-secondary);
  margin-top:20px;
  margin-bottom: 25px;
  text-shadow: 0 0 15px rgba(0, 121, 192, 0.8);
}
/* Novo estilo para a sugest√£o final */
.bet-zone-list {
    font-size: 20px;
    font-weight: 700;
    color: var(--alert-green);
    text-shadow: 0 0 10px rgba(0, 168, 89, 0.6);
    border: 2px solid var(--alert-green);
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    line-height: 1.5;
}

/* ================== ANIMA√á√ÉO DE CONFIRMA√á√ÉO ================== */

.confirmation-animation {
    margin-top: 15px;
    padding: 10px;
    border: 1px dashed var(--muted);
    border-radius: 8px;
    font-size: 14px;
}

.conf-line {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 5px;
    font-weight: 700;
}
.conf-icon {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 10px;
    font-weight: 900;
    transition: background-color 0.5s;
    flex-shrink: 0;
}
.conf-pending { background-color: var(--status-pending); animation: pulse 1s infinite alternate; }
.conf-success { background-color: var(--status-success); }
.conf-fail { background-color: var(--status-fail); }

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 195, 0, 0.7); }
    100% { box-shadow: 0 0 0 5px rgba(255, 195, 0, 0); }
}

.status-text-ready {
    color: var(--status-success);
    font-size: 1.5em;
    font-family: 'Passion One', cursive;
    text-shadow: 0 0 5px var(--status-success);
}
.status-text-fail {
    color: var(--status-fail);
    font-size: 1.3em;
    font-weight: 700;
}

</style>
</head>
<body id="bodyTag">

<div id="lockScreen" class="hidden">
  <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" fill="currentColor" viewBox="0 0 16 16" id="lockIcon">
    <path d="M8 1a2 2 0 0 0-2 2v4h4V3a2 2 0 0 0-2-2m3 6V3a3 3 0 1 0-6 0v4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1zM4 8a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5z"/>
  </svg>
  <h2 id="lockTitle">ZONA SEGURA ATINGIDA (STOP LOSS)</h2>
  <p>An√°lise bloqueada. Retorne ap√≥s o per√≠odo de resfriamento:</p>
  <div class="countdown" id="countdownTimer">02:00:00</div>
  
  <button id="btnSkipLock" class="control-btn" 
          style="margin-top: 30px; background: #6c757d; font-size: 16px;">
      <span class="material-symbols-outlined">lock_open</span>
      PULAR BLOQUEIO (QUEBRAR REGRA)
  </button>
</div>


<div id="loginScreen"> 
  <div id="loginBox">
    <div class="login-title">IAP BRASIL üáßüá∑</div>
    <div class="login-subtitle">Interface de An√°lise de Padr√µes</div>

    <div id="signInForm">
      <input id="authPwd" type="password" placeholder="Senha de Acesso (Modo Real)" autocomplete="current-password" required><br>
      
      <div style="display:flex; gap:10px; margin-top:15px;">
          <button id="btnSignInReal" class="control-btn" style="flex:1; background: linear-gradient(90deg, #ffc400, #ff8c00); color: var(--black);">MODO REAL</button>
          <button id="btnSignInDemo" class="control-btn" style="flex:1; background: var(--btn-main); color: #fff;">MODO DEMO</button>
      </div>
      
    </div>
    
  </div>
</div>

<div id="mainPanel" class="hidden">
  <div class="header">
    <div style="display: flex; align-items: center;">
        <div class="title">IAP BRASIL</div>
        <div id="sessionTimer">Sess√£o: -:-</div>
    </div>
    <div id="clock">--:--:--</div>
  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">payments</span>
        GEST√ÉO DE BANCA E RISCO
    </div>
    
    <div class="bankroll-grid" style="display:flex; gap: 15px;">
        <div style="flex:1;">
            <div class="bankroll-label">BANCA INICIAL (R$)</div>
            <input id="initialBankrollInput" type="number" class="bankroll-input" placeholder="1000" min="0" step="0.01">
            <button id="btnSetBankroll" class="control-btn" style="width: 100%; margin-top: 8px;">
                <span class="material-symbols-outlined">account_balance</span>
                DEFINIR BANCA
            </button>
        </div>
        <div class="bankroll-actions" style="flex:1;">
            <div class="bankroll-label">REGISTRAR ENTRADA (R$)</div>
            <input id="betAmountInput" type="number" class="bankroll-input" placeholder="Valor ganho/perdido" min="0" step="0.01">
            <div style="display:flex; gap: 8px;">
                <button id="btnRegisterWin" class="control-btn btn-win" style="flex:1; margin-top: 8px;">GREEN (+)</button>
                <button id="btnRegisterLoss" class="control-btn btn-loss" style="flex:1; margin-top: 8px;">RED (-)</button>
            </div>
        </div>
    </div>
    
    <div class="data-separator"></div>
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">monitoring</span>
        ESTAT√çSTICAS DE DESEMPENHO
    </div>
    <div id="performanceDashboard" class="dashboard-grid">
      <span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>
    </div>

  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">receipt_long</span>
        EXTRATO DE TRANSA√á√ïES
    </div>
    <div id="bankrollHistory" class="bankroll-history-list">
      <div class="log-item log-placeholder">Nenhum registro ainda.</div>
    </div>
  </div>
  
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="suggestionTitle history-title">
        <span class="material-symbols-outlined">history</span>
        HIST√ìRICO DA ROLETA <span id="historyCount" class="history-subtitle">0/100</span>
      </div>
      <div class="history-subtitle" style="font-size:11px;color:var(--muted)">Recentes ‚Üí Antigos (Scroll)</div> 
    </div>
    <div id="history" class="history"></div>
  </div>
  

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">dialpad</span>
        ENTRADAS R√ÅPIDAS
    </div>
    <div class="grid" id="gridNumbers"></div>
    <div class="data-separator"></div>
    <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <button id="btnUpload" class="control-btn" style="flex:1 1 150px;">
            <span class="material-symbols-outlined">camera_alt</span>
            üì∏ Enviar foto
        </button> 
        <button id="clearBtn" class="control-btn btn-loss" title="Limpar hist√≥rico" style="flex:1 1 100px;">
            <span class="material-symbols-outlined">delete</span>
            LIMPAR
        </button>
        <button id="logoutBtn" class="control-btn control-logout" title="Sair" style="flex:1 1 100px;">
            <span class="material-symbols-outlined">logout</span>
            SAIR
        </button>
    </div>
  </div>
  
  <div class="card" id="latestSuccessorsCard" style="display:none;">
    <div class="suggestionTitle" style="color: var(--accent-secondary); border-bottom-color: var(--accent-secondary);">
        <span class="material-symbols-outlined">repeat</span>
        √öLTIMOS SUCESSORES DO GATILHO (<span id="successorTriggerNum" style="font-weight: 700;">-</span>)
    </div>
    <div id="latestSuccessorsList" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
        <span style="color:var(--muted)">Adicione n√∫meros ao hist√≥rico para ver os sucessores.</span>
    </div>
  </div>
  <div class="card">
    <div class="analysis-wrapper">
      <div class="analysis-main">
        <div class="suggestionTitle">
            <span class="material-symbols-outlined">auto_fix</span>
            SUCESS√ÉO DE ZONAS (ZONA 5)
        </div>
        <div id="zoneAnalysis" class="suggestionBox">Adicione n√∫meros ao hist√≥rico para an√°lise de Zonas.</div>
      </div>
      <div class="analysis-hot-cold" style="margin-top:15px;">
        <div class="suggestionTitle">
            <span class="material-symbols-outlined">thermometer</span>
            TEND√äNCIAS GERAIS
        </div>
        <div id="hotCold" class="suggestionBox">üî• Hot: -<br>‚ùÑÔ∏è Cold: -</div>
      </div>
    </div>
  </div>

  <div class="card" id="boosterCard">
    <div class="suggestionTitle iaGlow">
        <span class="material-symbols-outlined">magic_button</span>
        BOOSTER DE APOSTA I.A.
    </div>
    <div id="betSuggestion" class="suggestionBox" style="font-size: 16px; font-weight: 700;">
        <span style="color:var(--muted)">Aguardando dados ou aguardando desbloqueio...</span>
    </div>
  </div>
  
  <input type="file" id="uploadPhoto" accept="image/*" class="hidden">
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ================== CONSTANTES DE CONFIGURA√á√ÉO ================== */
  // --- SENHA ALTERADA PARA 2025 ---
  const getPasswordHash = () => '2025'; 
  // ---------------------------------
  const BANKROLL_STORAGE_KEY = 'roletaIAPBankroll_main';
  const HISTORY_STORAGE_KEY = 'roletaIAPHistory'; 
  const CONFIG_STORAGE_KEY = 'roletaIAPConfig'; 
  
  const WHEEL_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
  const WHEEL_INDEX_MAP = {};
  WHEEL_ORDER.forEach((num, index) => { WHEEL_INDEX_MAP[num] = index; });

  const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36]);
  
  // Constantes de Stop Loss/Win/Sess√£o
  const STOP_LOSS_COUNT = 2; // 2 REDs consecutivos
  const STOP_LOSS_AMOUNT = 35.00; // R$35,00 de preju√≠zo total
  const STOP_WIN_COUNT = 3; // 3 WINs consecutivos
  const STOP_WIN_AMOUNT = 35.00; // R$35,00 de lucro total
  const LOCK_DURATION = 2 * 60 * 60 * 1000; // 2 horas em milis

  /* =========================================================================================
   * CONFIGURA√á√ïES ESPEC√çFICAS DO BOOSTER I.A. (Quebra de Sucess√£o)
   ========================================================================================= */
  const SUCCESSOR_LOOKBACK = 100; 
  const MIN_HISTORY_FOR_BOOSTER = 10; 
  const SUCCESSOR_DISPLAY_LIMIT = 10; 
  const CONFIRMATION_ROUNDS = 4; // M√≠nimo de repeti√ß√µes do Gatilho como predecessor.
  const CONFIRMATION_ROUNDS_UI = 3; // Quantas confirma√ß√µes de "fora da zona" s√£o necess√°rias.


  
  /* ================== ELEMENTOS DOM (Mantidos) ================== */
  const bodyTag = document.getElementById('bodyTag');
  const loginScreen = document.getElementById('loginScreen');
  const mainPanel = document.getElementById('mainPanel');
  const lockScreen = document.getElementById('lockScreen');
  const lockTitle = document.getElementById('lockTitle');
  const countdownTimer = document.getElementById('countdownTimer');
  const btnSkipLock = document.getElementById('btnSkipLock');
  const sessionTimerDiv = document.getElementById('sessionTimer'); 
  const boosterCard = document.getElementById('boosterCard');
  
  const historyDiv = document.getElementById('history');
  const historyCount = document.getElementById('historyCount');
  const zoneAnalysisDiv = document.getElementById('zoneAnalysis');
  const hotColdDiv = document.getElementById('hotCold');
  const betSuggestionDiv = document.getElementById('betSuggestion'); 
  const gridNumbers = document.getElementById('gridNumbers');
  
  const latestSuccessorsCard = document.getElementById('latestSuccessorsCard');
  const latestSuccessorsList = document.getElementById('latestSuccessorsList');
  const successorTriggerNumDiv = document.getElementById('successorTriggerNum');


  const btnRegisterWin = document.getElementById('btnRegisterWin');
  const btnRegisterLoss = document.getElementById('btnRegisterLoss');
  const betAmountInput = document.getElementById('betAmountInput');
  const initialBankrollInput = document.getElementById('initialBankrollInput');
  const bankrollHistoryDiv = document.getElementById('bankrollHistory');
  const authPwdInput = document.getElementById('authPwd');
  const btnUpload = document.getElementById('btnUpload'); 
  const uploadPhotoInput = document.getElementById('uploadPhoto');
  const clearBtn = document.getElementById('clearBtn');
  
  /* ================== ESTADO DA APLICA√á√ÉO (MODIFICADO) ================== */
  let historyArr = []; 
  let numberStats = {}; 
  let config = {
      mode: 'DEMO', 
      isLoggedIn: false, 
      isLocked: false,
      lockUntil: 0,
      lockReason: '', 
      sessionStart: 0, 
      boosterConfirmations: 0, // Contador de confirma√ß√µes de "fora da zona"
      boosterIsLocked: false, // NOVO: Trava o estado ap√≥s o gatilho ser detectado
  };
  
  let bankrollState = {
    initial: 0,
    current: 0,
    history: [] 
  };
  const MAX_HISTORY = 100;
  
  /* ================== UTILIT√ÅRIOS OTIMIZADOS ================== */
  const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2 });
  function getColor(num) {
    if (num === 0) return 'zero';
    if (RED_NUMBERS.has(num)) return 'red';
    return 'black';
  }
  
  const safeMath = (num) => parseFloat(num.toFixed(2));


  /**
   * Obt√©m vizinhos de um n√∫mero com um raio espec√≠fico.
   */
  function getNeighbors(centerNum, radius) {
    const centerIndex = WHEEL_INDEX_MAP[centerNum];
    const neighbors = [];
    const len = WHEEL_ORDER.length;

    for (let i = -radius; i <= radius; i++) {
        const index = (centerIndex + i + len) % len;
        neighbors.push(WHEEL_ORDER[index]);
    }
    return neighbors; 
  }
  
  /* ================== PERSIST√äNCIA E SESS√ÉO ================== */
  
  function saveConfig() {
    localStorage.setItem(CONFIG_STORAGE_KEY, JSON.stringify(config));
  }
  function loadConfig() {
    try {
        const savedConfig = localStorage.getItem(CONFIG_STORAGE_KEY);
        if (savedConfig) {
          const loaded = JSON.parse(savedConfig);
          config.mode = loaded.mode || 'DEMO';
          config.isLoggedIn = loaded.isLoggedIn || false; 
          config.isLocked = loaded.isLocked || false;
          config.lockUntil = loaded.lockUntil || 0;
          config.lockReason = loaded.lockReason || '';
          config.sessionStart = loaded.sessionStart || 0;
          config.boosterConfirmations = loaded.boosterConfirmations || 0;
          config.boosterIsLocked = loaded.boosterIsLocked || false; // NOVO
        }
    } catch (e) {
        console.error("Erro ao carregar configura√ß√£o:", e);
    }
  }
  
  function setLoginStatus(isLoggedIn, mode = 'DEMO') {
      config.isLoggedIn = isLoggedIn;
      config.mode = mode; 
          
      if (isLoggedIn) {
          config.sessionStart = Date.now();
      } else {
          config.sessionStart = 0; 
      }
      saveConfig();
  }

  function getLoginStatus() {
      return config.isLoggedIn; 
  }
  
  /* ================== L√ìGICA DE BLOQUEIO / STOP / SESS√ÉO ================== */

  let countdownInterval;

  function checkLockStatus() {
      const now = Date.now();
      
      // 1. Verifica se o bloqueio existente terminou
      if (config.isLocked && config.lockUntil > now) {
          lockScreen.classList.remove('hidden');
          mainPanel.classList.add('hidden');
          bodyTag.classList.remove('login-active'); 
          
          let titleText = '';
          if (config.lockReason === 'STOP_LOSS') { titleText = 'ZONA SEGURA ATINGIDA (STOP LOSS)'; }
          else if (config.lockReason === 'STOP_WIN') { titleText = 'ZONA SEGURA ATINGIDA (STOP WIN)'; }
          else if (config.lockReason === 'SKIPPED') { titleText = 'BLOQUEIO INTERROMPIDO'; } 

          lockTitle.textContent = titleText;
          lockTitle.classList.toggle('win', config.lockReason === 'STOP_WIN');
          document.getElementById('lockIcon').style.color = (config.lockReason === 'STOP_WIN') ? 'var(--alert-green)' : 'var(--alert-red)';

          startLockCountdown();
          return true; 
      }

      // 2. Se o bloqueio terminou (ou n√£o existia), desbloqueia/mant√©m desbloqueado
      if (config.isLocked && config.lockUntil <= now) {
          // Bloqueio terminou! Resetamos o estado.
          config.isLocked = false;
          config.lockUntil = 0;
          config.lockReason = '';
          
          // **AJUSTE CR√çTICO**: Reset da banca e do hist√≥rico de transa√ß√µes.
          if (bankrollState.initial > 0) {
            bankrollState.initial = bankrollState.current; 
            bankrollState.history = []; // RESET DO HIST√ìRICO PARA NOVO CICLO
            saveBankrollData();
          }

          config.sessionStart = Date.now(); 
          saveConfig();
      }
      
      // 3. Estado Desbloqueado e Logado
      lockScreen.classList.add('hidden');
      if (getLoginStatus()) {
          mainPanel.classList.remove('hidden');
          loginScreen.classList.add('hidden');
          bodyTag.classList.remove('login-active');
          sessionTimerDiv.textContent = `Sess√£o: -:-`; 
      } else {
          // N√£o logado
          loginScreen.classList.remove('hidden');
          mainPanel.classList.add('hidden');
          bodyTag.classList.add('login-active'); 
      }
      stopLockCountdown();
      return false; 
  }
  
  function startLockCountdown() {
      stopLockCountdown(); 
      
      countdownInterval = setInterval(() => {
          const remainingTime = config.lockUntil - Date.now();
          if (remainingTime <= 0) {
              checkLockStatus(); 
              return;
          }

          const totalSeconds = Math.floor(remainingTime / 1000);
          const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
          const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
          const seconds = String(totalSeconds % 60).padStart(2, '0');
          
          countdownTimer.textContent = `${hours}:${minutes}:${seconds}`;

      }, 1000);
  }

  function stopLockCountdown() {
      if (countdownInterval) {
          clearInterval(countdownInterval);
          countdownInterval = null; 
      }
  }
  
  function triggerLock(reason) {
      if (config.mode !== 'REAL') return;

      config.isLocked = true;
      config.lockUntil = Date.now() + LOCK_DURATION;
      config.lockReason = reason;
      saveConfig();
      
      checkLockStatus();
  }
  
  function skipLock() {
    if (!config.isLocked) return;

    if (confirm('ATEN√á√ÉO! Voc√™ est√° prestes a quebrar a regra de Stop Loss/Win. Isso pode comprometer sua gest√£o de risco. Tem certeza que deseja pular o bloqueio?')) {
        config.lockUntil = Date.now() - 1; 
        config.isLocked = false;
        config.lockReason = 'SKIPPED';
        saveConfig();
        
        if (bankrollState.initial > 0) {
            bankrollState.initial = bankrollState.current; 
            bankrollState.history = []; 
            saveBankrollData();
        }

        config.sessionStart = Date.now(); 
        stopLockCountdown(); 
        checkLockStatus(); 
        updateUI(); 
    }
}

  function checkStopCondition() {
      if (config.mode !== 'REAL' || config.isLocked || bankrollState.initial === 0) return;

      const { current, initial, history } = bankrollState;
      const totalProfit = safeMath(current - initial); 
      
      if (totalProfit <= -STOP_LOSS_AMOUNT) {
          triggerLock('STOP_LOSS');
          return;
      }
      if (totalProfit >= STOP_WIN_AMOUNT) {
          triggerLock('STOP_WIN');
          return;
      }
      
      let consecutiveLoss = 0;
      let consecutiveWin = 0;
      
      for (let i = history.length - 1; i >= 0; i--) {
          const amount = history[i].amount;
          
          if (amount === 0) continue; 
          
          if (amount < 0) {
              consecutiveLoss++;
              consecutiveWin = 0; 
          } else if (amount > 0) {
              consecutiveWin++;
              consecutiveLoss = 0; 
          }
          
          if (consecutiveLoss >= STOP_LOSS_COUNT) {
              triggerLock('STOP_LOSS');
              return;
          }
          if (consecutiveWin >= STOP_WIN_COUNT) {
              triggerLock('STOP_WIN');
              return;
          }
      }
  }

  function saveBankrollData() {
    localStorage.setItem(BANKROLL_STORAGE_KEY, JSON.stringify(bankrollState));
  }
  function loadBankrollData() {
    try {
        const savedData = localStorage.getItem(BANKROLL_STORAGE_KEY);
        if (savedData) {
          bankrollState = JSON.parse(savedData);
          bankrollState.initial = safeMath(bankrollState.initial || 0); 
          bankrollState.current = safeMath(bankrollState.current || 0); 
          bankrollState.history = bankrollState.history || [];
          bankrollState.history = bankrollState.history.map(item => ({
              amount: safeMath(item.amount),
              timestamp: item.timestamp 
          }));
        } else {
          bankrollState = { initial: 0, current: 0, history: [] };
        }
        initialBankrollInput.value = bankrollState.initial > 0 ? bankrollState.initial : '';
    } catch (e) {
        console.error("Erro ao carregar dados da Banca:", e);
    }
  }

  function saveHistoryData() {
    localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(historyArr));
  }
  function loadHistoryData() {
    try {
        const savedHistory = localStorage.getItem(HISTORY_STORAGE_KEY);
        if (savedHistory) {
          historyArr = JSON.parse(savedHistory)
            .map(n => parseInt(n, 10))
            .filter(n => !isNaN(n) && n >= 0 && n <= 36);
        } else {
          historyArr = [];
        }
    } catch (e) {
        console.error("Erro ao carregar Hist√≥rico:", e);
    }
  }

  function calculateStats() {
    const allNumbers = [...Array(37).keys()]; 
    const stats = {
      counts: {},
      zoneSuccessionMap: {}, 
      hotList: [],
      coldList: [],
    };
    allNumbers.forEach(n => { stats.counts[n] = { count: 0 }; });

    for (let i = 0; i < historyArr.length; i++) {
      const currentNum = historyArr[i];
      stats.counts[currentNum].count++;
      
      if (i < historyArr.length - 1) {
        const nextNum = historyArr[i + 1]; 
        if (!stats.zoneSuccessionMap[currentNum]) { stats.zoneSuccessionMap[currentNum] = []; }
        stats.zoneSuccessionMap[currentNum].push(nextNum);
      }
    }
    
    const allCounts = allNumbers.map(n => stats.counts[n].count);
    const avgCount = allCounts.length > 0 ? allCounts.reduce((a, b) => a + b, 0) / allCounts.length : 0;

    stats.hotList = allNumbers
      .filter(n => stats.counts[n].count > avgCount) 
      .sort((a, b) => stats.counts[b].count - stats.counts[a].count) 
      .slice(0, 4);
    
    stats.coldList = allNumbers
      .filter(n => stats.counts[n].count < avgCount)
      .sort((a, b) => stats.counts[a].count - stats.counts[b].count) 
      .slice(0, 4);

    numberStats = stats;
  }
  
  // ==================== L√ìGICA DE ADI√á√ÉO DE N√öMEROS (MODIFICADA) ====================
  
  function addNumber(num) {
    if (num < 0 || num > 36 || isNaN(num)) {
        console.error("Tentativa de adicionar n√∫mero inv√°lido:", num);
        return;
    }
    
    // --- L√ìGICA DE QUEBRA/CONFIRMA√á√ÉO DO BOOSTER I.A. ---
    
    // 1. Verificar se o Booster I.A. est√° no modo de Confirma√ß√£o/Travado
    if (config.boosterIsLocked && config.boosterBetZone && config.boosterBetZone.length > 0) {
        
        const currentZone = config.boosterBetZone;
        const triggerNum = config.boosterTriggerNum;
        
        // Define a Zona de Risco: A Zona de Aposta (4 sucessores) + o Gatilho (para dobradinha)
        const riskZone = new Set([...currentZone]);
        riskZone.add(triggerNum);
        
        const numberLandedInBetZone = currentZone.includes(Number(num));
        const isDoublet = (Number(num) === triggerNum); // Repeti√ß√£o do Gatilho

        // NOVO: Quebra de Padr√£o (Caiu na Zona de Aposta ou Dobradinha)
        if (numberLandedInBetZone || isDoublet) {
            // Padr√£o Quebrado/Falha
            config.boosterConfirmations = 0; // Reset
            config.boosterIsLocked = false; // Destrava
            delete config.boosterBetZone; // Limpa a zona de aposta anterior
            delete config.boosterTriggerNum; // Limpa o Gatilho anterior
        } else {
            // Confirma√ß√£o: o n√∫mero caiu FORA da Zona de Aposta/Risco.
            config.boosterConfirmations++;
        }
        
        saveConfig();
    } 
    
    // ----------------------------------------------
    
    if (historyArr.length >= MAX_HISTORY) { historyArr.pop(); }
    historyArr.unshift(Number(num)); 
    saveHistoryData();
    updateUI(); 
  }
  
  function addMultipleNumbers(numArray) {
    const validNumbers = numArray
      .map(n => parseInt(n, 10))
      .filter(n => !isNaN(n) && n >= 0 && n <= 36);
      
    if (validNumbers.length === 0) {
        alert('Nenhum n√∫mero de 0 a 36 v√°lido identificado.');
        return;
    }
    
    // Como a l√≥gica de confirma√ß√£o √© baseada no LANCE ANTERIOR, 
    // e para inputs em lote pode ser complexo, limpamos o estado do booster para seguran√ßa.
    
    config.boosterConfirmations = 0;
    config.boosterIsLocked = false;
    delete config.boosterBetZone;
    delete config.boosterTriggerNum;
    saveConfig();
         
    let numbersToAdd = [...validNumbers];
    numbersToAdd.reverse().forEach(n => {
         if (historyArr.length >= MAX_HISTORY) { historyArr.pop(); }
         historyArr.unshift(Number(n)); 
    });
    
    saveHistoryData();
    updateUI();
  }

  function renderLatestSuccessors() {
    if (historyArr.length < 2) {
        latestSuccessorsCard.style.display = 'none';
        return;
    }

    const triggerNum = historyArr[0];
    const recentSuccessors = [];
    const limit = Math.min(historyArr.length - 1, SUCCESSOR_LOOKBACK);

    for (let i = 1; i <= limit; i++) {
        const predecessorNum = historyArr[i];
        const successorNum = historyArr[i - 1]; 
        
        if (predecessorNum === triggerNum) {
            recentSuccessors.push(successorNum);
        }
    }

    latestSuccessorsCard.style.display = 'block';
    successorTriggerNumDiv.textContent = triggerNum;
    latestSuccessorsList.innerHTML = ''; 

    if (recentSuccessors.length === 0) {
        latestSuccessorsList.innerHTML = `<span style="color:var(--muted)">O n√∫mero **${triggerNum}** n√£o se repetiu como predecessor nos √∫ltimos ${limit} lan√ßamentos.</span>`;
        return;
    }
    
    const displaySuccessors = recentSuccessors.slice(0, SUCCESSOR_DISPLAY_LIMIT); 
    
    let html = `
        <span style="color: var(--black); font-weight: 700; flex-shrink: 0;">Total: ${recentSuccessors.length}x</span>
    `;

    displaySuccessors.forEach((num, index) => {
        html += `<div class="chip ${getColor(num)}" 
                     style="width: 30px; height: 30px; font-size: 12px; font-weight: 700; flex-shrink: 0;" 
                     title="Ordem de Apari√ß√£o: ${index + 1}¬∫ mais recente (Recente ‚Üí Antigo)">
                     ${num}
                 </div>`;
    });
    
    if (recentSuccessors.length > SUCCESSOR_DISPLAY_LIMIT) {
         html += `<span style="font-size: 12px; color: var(--muted); align-self: flex-end; flex-shrink: 0;">...e mais ${recentSuccessors.length - SUCCESSOR_DISPLAY_LIMIT}</span>`;
    }

    latestSuccessorsList.innerHTML = html;
  }
  
  // ==================== L√ìGICA DE AN√ÅLISE DE SUCESS√ÉO DE ZONAS (Mantida) ====================
  function renderZoneAnalysis() {
    if (historyArr.length < 2) { 
      zoneAnalysisDiv.innerHTML = '<span style="color:var(--muted)">Adicione pelo menos 2 n√∫meros ao hist√≥rico para an√°lise de Sucess√£o de Zonas.</span>';
      return;
    }
    
    const LOOKBACK_ZONA = 100;
    const triggerNum = historyArr[0]; 
    const triggerZone = getNeighbors(triggerNum, 2); 
    
    const zoneFollowers = {};
    const lastAppearanceIndex = {}; 
    let totalOccurrences = 0;
    
    for (let i = 1; i < historyArr.length && i <= LOOKBACK_ZONA; i++) {
        const predecessorNum = historyArr[i];
        const successorNum = historyArr[i - 1];
        
        if (triggerZone.includes(predecessorNum)) {
            zoneFollowers[successorNum] = (zoneFollowers[successorNum] || 0) + 1;
            totalOccurrences++;
            
            if (!lastAppearanceIndex[successorNum] || i < lastAppearanceIndex[successorNum]) {
                lastAppearanceIndex[successorNum] = i; 
            }
        }
    }

    if (totalOccurrences === 0) { 
      zoneAnalysisDiv.innerHTML = `<span style="color:var(--muted)">A **Zona ${triggerNum}** (${triggerZone.join(', ')} ) n√£o teve ocorr√™ncias registradas como predecessor nos √∫ltimos ${Math.min(historyArr.length, LOOKBACK_ZONA)} lan√ßamentos.</span>`;
      return;
    }
    
    const processed = new Set();
    const successorGroups = [];

    for (const num of WHEEL_ORDER) {
        if (zoneFollowers[num] && !processed.has(num)) {
            let group = [num];
            let groupCount = zoneFollowers[num];
            processed.add(num);

            let currentIdx = WHEEL_INDEX_MAP[num];
            let groupLastAppearance = lastAppearanceIndex[num]; 

            let isContiguous = true;
            while (isContiguous) {
                let nextIdx = (currentIdx + 1) % WHEEL_ORDER.length;
                let nextNum = WHEEL_ORDER[nextIdx];
                
                if (zoneFollowers[nextNum] && !processed.has(nextNum)) {
                    group.push(nextNum);
                    groupCount += zoneFollowers[nextNum];
                    processed.add(nextNum);
                    currentIdx = nextIdx;
                    if (lastAppearanceIndex[nextNum] < groupLastAppearance) {
                        groupLastAppearance = lastAppearanceIndex[nextNum];
                    }
                } else {
                    isContiguous = false; 
                }
                
                if (group.length === WHEEL_ORDER.length) break; 
            }
            
            successorGroups.push({ 
                numbers: group, 
                count: groupCount,
                first: group[0],
                last: group[group.length - 1],
                recentIndex: groupLastAppearance 
            });
        }
    }

    successorGroups.sort((a, b) => {
        if (a.recentIndex !== b.recentIndex) {
            return a.recentIndex - b.recentIndex; 
        }
        return b.count - a.count; 
    });
    
    let html = `
        <div class="analysis-output">
            <div class="pattern-line">√öltimo lan√ßamento (GATILHO): <span class="pattern-trigger">${triggerNum}</span></div>
            <div class="pattern-line pattern-count">**ZONA DE AN√ÅLISE (5 N√∫meros):** <span style="font-weight: bold; color: var(--accent);">${triggerZone.join(', ')}</span></div>
            <div class="data-separator" style="margin: 8px 0;"></div>
    `;

    successorGroups.forEach(group => {
        const percentage = safeMath((group.count / totalOccurrences) * 100);
        html += `
            <div class="pattern-line">
                SUCESS√ÉO DE ${group.numbers.length} N√öMERO(S): 
                <span class="pattern-succession">${group.numbers.join(', ')}</span>
                <span class="pattern-count">(${group.count}x, ${percentage}%) | Mais recente: ${group.recentIndex}¬∫</span>
            </div>
        `;
    });
    
    html += '</div>';
    zoneAnalysisDiv.innerHTML = html;
  }
  
  
  // =========================================================================================
  // üöÄ C√ìDIGO DO BOOSTER I.A. (MODIFICADO COM L√ìGICA DE 4 SUCESSORES E TRAVAMENTO)
  // =========================================================================================

  /**
   * NOVO: Pega os 4 sucessores da √öLTIMA apari√ß√£o do Gatilho.
   */
  function findBoosterSuccessors(triggerNum) {
    let triggerCount = 0;
    const limit = SUCCESSOR_LOOKBACK;
    let lastTriggerIndex = -1; // √çndice mais recente (0 √© o √∫ltimo lance)
    
    // 1. Conta apari√ß√µes e encontra o √≠ndice da √∫ltima (mais recente) ocorr√™ncia do gatilho
    for (let i = 0; i < historyArr.length && i < limit; i++) {
        const num = historyArr[i];
        if (num === triggerNum) {
            triggerCount++;
            if (lastTriggerIndex === -1) {
                lastTriggerIndex = i;
            }
        }
    }
    
    // 2. Verifica a condi√ß√£o m√≠nima (4x) e se h√° dados suficientes para 4 sucessores
    if (triggerCount < CONFIRMATION_ROUNDS) {
        return { 
            triggerCount: triggerCount, 
            successors: [], 
            lastTriggerIndex: -1
        };
    }
    
    // 3. Pega os 4 n√∫meros que ca√≠ram AP√ìS o √∫ltimo gatilho
    let successors = [];
    
    // O Gatilho est√° em historyArr[lastTriggerIndex]. 
    // O primeiro sucessor √© historyArr[lastTriggerIndex - 1].
    // O array √© ordenado do mais recente (√≠ndice 0) para o mais antigo (√≠ndice N).
    
    const startIndexForSuccessors = lastTriggerIndex - 1; 

    for (let i = 0; i < 4; i++) {
        const index = startIndexForSuccessors - i;
        if (index >= 0) {
            successors.push(historyArr[index]);
        }
    }

    // Se encontramos menos de 4 sucessores, significa que a hist√≥ria √© muito curta ou o gatilho √© muito recente.
    if (successors.length < 4) {
        return { 
            triggerCount: triggerCount, 
            successors: [],
            lastTriggerIndex: lastTriggerIndex
        };
    }

    // Reverte para exibir na ordem que ca√≠ram (do primeiro ao quarto sucessor).
    return { 
        triggerCount: triggerCount, 
        successors: successors.reverse(), 
        lastTriggerIndex: lastTriggerIndex
    };
  }
  
  /**
   * ‚öôÔ∏è Fun√ß√£o principal para renderizar a Sugest√£o de Aposta (Booster I.A.).
   */
  function renderBetSuggestion() {
    if (config.isLocked || historyArr.length < MIN_HISTORY_FOR_BOOSTER) {
        let msg = '<span style="color:var(--muted)">';
        if (config.isLocked) {
            msg += `‚õî **ANALISADOR BLOQUEADO:** Motivo: ${config.lockReason === 'STOP_LOSS' ? 'Stop Loss' : 'Stop Win'}.`;
        } else {
            msg += `‚è≥ **AGUARDANDO DADOS:** M√≠nimo de ${MIN_HISTORY_FOR_BOOSTER} lan√ßamentos necess√°rios. (${historyArr.length} / ${MIN_HISTORY_FOR_BOOSTER})`;
        }
        msg += '</span>';
        betSuggestionDiv.innerHTML = msg;
        
        // Se n√£o houver dados suficientes, garante que o estado do booster √© limpo
        config.boosterConfirmations = 0;
        config.boosterIsLocked = false;
        delete config.boosterBetZone;
        delete config.boosterTriggerNum;
        saveConfig();
        return;
    }

    const currentTriggerNum = historyArr[0];

    // --- MODO TRAVADO: A aposta anterior precisa ser resolvida ---
    if (config.boosterIsLocked) {
        
        const triggerNum = config.boosterTriggerNum;
        const betZone = config.boosterBetZone;
        
        if (!betZone || betZone.length === 0) {
            config.boosterIsLocked = false;
            saveConfig();
            return renderBetSuggestion(); 
        }
        
        // Recalcula o triggerCount apenas para exibi√ß√£o
        const result = findBoosterSuccessors(triggerNum);
        const triggerCount = result.triggerCount;

        // Confirma√ß√£o Bem-sucedida! Sugere a APOSTA.
        if (config.boosterConfirmations >= CONFIRMATION_ROUNDS_UI) {
            
            // Destrava e limpa o estado, encerrando o ciclo.
            config.boosterConfirmations = 0;
            config.boosterIsLocked = false;
            delete config.boosterBetZone;
            delete config.boosterTriggerNum;
            saveConfig();
            
            betSuggestionDiv.innerHTML = `
                <p style="margin-bottom: 5px;">
                    GATILHO: <span class="iaGlow" style="font-size: 1.2em;">${triggerNum}</span> 
                    <span style="color: var(--alert-green); font-size: 14px; font-weight: bold;"> (Confirmado ${triggerCount}x)</span>
                </p>
                
                <p class="status-text-ready">
                    ‚úÖ CONFIRMA√á√ïES OBTIDAS! APOSTE!
                </p>

                <p style="font-size: 14px; margin-top: 10px; margin-bottom: 5px; color: var(--muted);">
                    üéØ **ZONA DE APOSTA (4 SUCESSORES):**
                </p>

                <div class="bet-zone-list">
                    ${betZone.join(', ')}
                </div>
                
                <p style="font-size: 14px; margin-top: 10px; color: var(--alert-green); font-weight: bold;">
                    PR√ìXIMO CICLO: A I.A. ir√° procurar um novo gatilho.
                </p>
            `;
            return;
        }
        
        // Renderiza√ß√£o no Modo de Confirma√ß√£o (Travado)
        let confirmationHtml = `<div class="confirmation-animation">
            <div class="conf-line" style="color: var(--status-pending); font-size: 1.1em;">
                <span class="conf-icon conf-pending">üü†</span>
                PADR√ÉO DETECTADO üü†
            </div>
            <p style="font-size: 12px; color: var(--muted); margin: 5px 0 10px 26px;">
                Gatilho Travado: **${triggerNum}** | Repeti√ß√µes: **${triggerCount}x** | Sucessores (4): **${betZone.join(', ')}**
            </p>
            <div style="margin-left: 10px;">
        `;

        for (let i = 1; i <= CONFIRMATION_ROUNDS_UI; i++) {
            const isConfirmed = i <= config.boosterConfirmations;
            const statusClass = isConfirmed ? 'conf-success' : 'conf-pending';
            const iconContent = isConfirmed ? '‚úî' : '...';
            const colorStyle = isConfirmed ? 'color: var(--status-success);' : 'color: var(--muted);';

            confirmationHtml += `
                <div class="conf-line" style="${colorStyle}">
                    <span class="conf-icon ${statusClass}">${iconContent}</span>
                    Confirma√ß√£o ${i} ${isConfirmed ? 'üü¢' : '...'}
                </div>
            `;
        }
        
        confirmationHtml += `</div></div>`;
        
        betSuggestionDiv.innerHTML = `
            <p style="margin-bottom: 5px;">
                GATILHO **TRAVADO** (Para ${triggerNum}): 
                <span style="color: var(--alert-red); font-size: 14px; font-weight: bold;"> AGUARDANDO CONFIRMA√á√ïES</span>
            </p>

            <p style="font-size: 14px; margin-top: 10px; margin-bottom: 5px; color: var(--muted); font-weight: bold;">
                PR√ìXIMA A√á√ÉO: Aguardar **${CONFIRMATION_ROUNDS_UI - config.boosterConfirmations}** lances **FORA** da Zona de Risco/Aposta.
            </p>
            
            <div class="bet-zone-list" style="border-color: var(--status-pending); color: var(--status-pending); text-shadow: 0 0 8px rgba(255,195,0,0.8);">
                ${betZone.join(', ')}
            </div>
            <p style="font-size: 14px; margin-top: 5px; color: var(--muted);">
                Aposta √© nessa zona. A quebra ocorre se cair em um desses **${betZone.length}** n√∫meros ou no Gatilho (**${triggerNum}**).
            </p>

            ${confirmationHtml}
        `;
        return;
    }
    
    // --- MODO N√ÉO TRAVADO: Procura por novo Gatilho ---
    
    const result = findBoosterSuccessors(currentTriggerNum);
    const triggerCount = result.triggerCount;
    const successors = result.successors;

    if (triggerCount >= CONFIRMATION_ROUNDS && successors.length === 4) {
        // Padr√£o Detectado! Trava o estado e inicia a contagem.
        const betZone = successors; // Os 4 sucessores S√ÉO a zona de aposta.
        
        config.boosterBetZone = betZone;
        config.boosterTriggerNum = currentTriggerNum;
        config.boosterConfirmations = 0;
        config.boosterIsLocked = true; // TRAVA AQUI
        saveConfig();
        
        // Chamamos a fun√ß√£o novamente para renderizar o estado travado/de confirma√ß√£o.
        return renderBetSuggestion(); 
    } 
    
    // Gatilho n√£o confirmado ou sem sucessores suficientes.
    delete config.boosterBetZone;
    delete config.boosterTriggerNum;
    config.boosterConfirmations = 0;
    config.boosterIsLocked = false;
    saveConfig();
    
    let reasonText;
    if (triggerCount < CONFIRMATION_ROUNDS) {
        reasonText = `Frequ√™ncia baixa: O √∫ltimo n√∫mero **${currentTriggerNum}** se repetiu apenas **${triggerCount}x** como predecessor. M√≠nimo: **${CONFIRMATION_ROUNDS}x**.`;
    } else {
        reasonText = `Faltam dados: Apenas **${successors.length}** sucessores encontrados ap√≥s a √∫ltima apari√ß√£o do ${currentTriggerNum}. Requer **4 sucessores**.`;
    }
    
    betSuggestionDiv.innerHTML = `
        <span style="color:var(--alert-red); font-weight: bold;">
            ‚ùå GATILHO N√ÉO CONFIRMADO:
        </span>
        <p style="margin-top: 5px; color: var(--muted); font-weight: normal;">
            ${reasonText}
        </p>
    `;

  }

  // =========================================================================================
  // FIM DO NOVO C√ìDIGO INCLU√çDO/MODIFICADO
  // =========================================================================================
  
  
  // ================== FUN√á√ïES DE RENDERIZA√á√ÉO E UI (Ajustadas) ================== */
  
  function renderHistory() {
    historyDiv.innerHTML = ''; 
    historyCount.textContent = `${historyArr.length}/${MAX_HISTORY}`;
    
    if (historyArr.length === 0) {
        historyDiv.innerHTML = '<span style="color:var(--muted); font-style:italic;">Nenhum n√∫mero registrado.</span>';
        return;
    }
    
    historyArr.forEach((num, index) => {
        const colorClass = getColor(num);
        const chip = document.createElement('div');
        chip.className = `chip ${colorClass}`;
        chip.textContent = num;
        chip.title = `Ordem: ${index + 1}¬∫ | N√∫mero: ${num}`;
        chip.setAttribute('data-index', index);
        chip.addEventListener('click', () => removeNumberByIndex(index)); 
        historyDiv.appendChild(chip);
    });
  }
  
  function removeNumberByIndex(index) {
    if (confirm(`Tem certeza que deseja remover o n√∫mero ${historyArr[index]} da posi√ß√£o ${index + 1} (o ${index + 1}¬∫ mais recente)?`)) {
        historyArr.splice(index, 1);
        
        // Limpa estado do Booster ao remover n√∫mero, for√ßando rec√°lculo
        config.boosterConfirmations = 0;
        config.boosterIsLocked = false;
        delete config.boosterBetZone;
        delete config.boosterTriggerNum;
        saveConfig();
        
        saveHistoryData();
        updateUI();
    }
  }

  function renderBankrollDashboard() {
    const { initial, current, history } = bankrollState;
    const totalProfit = safeMath(current - initial);
    
    const profitClass = totalProfit >= 0 ? 'positive' : 'negative';
    const totalEntries = history.filter(item => item.amount !== 0).length;
    const totalWins = history.filter(item => item.amount > 0).length;
    const totalLosses = history.filter(item => item.amount < 0).length;
    const winRate = totalEntries > 0 ? safeMath((totalWins / totalEntries) * 100) : 0;
    
    let html = '';
    if (initial > 0) {
        html = `
            <div class="stat-item">
                <div class="stat-title">BANCA ATUAL</div>
                <div class="stat-value">${formatCurrency(current)}</div>
            </div>
            <div class="stat-item">
                <div class="stat-title">LUCRO / PREJU√çZO (TOTAL)</div>
                <div class="stat-value ${profitClass}">${formatCurrency(totalProfit)}</div>
            </div>
            <div class="stat-item">
                <div class="stat-title">TAXA DE VIT√ìRIA (W/L)</div>
                <div class="stat-value ${totalWins >= totalLosses ? 'positive' : 'negative'}">${winRate}%</div>
            </div>
            <div class="stat-item">
                <div class="stat-title">WINS / LOSSES</div>
                <div class="stat-value">${totalWins} / ${totalLosses}</div>
            </div>
        `;
    } else {
        html = `<span class="stat-title" style="grid-column: 1 / -1; color: var(--alert-red);">Defina sua banca inicial para ativar o Gerenciamento de Risco.</span>`;
    }
    
    document.getElementById('performanceDashboard').innerHTML = html;
  }

  function renderBankrollHistory() {
    bankrollHistoryDiv.innerHTML = '';
    const { history } = bankrollState;
    
    if (history.length === 0) {
        bankrollHistoryDiv.innerHTML = '<div class="log-item log-placeholder">Nenhum registro ainda.</div>';
        return;
    }
    
    history.slice().reverse().forEach((item, originalIndex) => {
        const index = history.length - 1 - originalIndex; // Para deletar o original
        const isWin = item.amount > 0;
        const logClass = isWin ? 'log-win' : 'log-loss';
        const sign = isWin ? '+' : '';

        const itemDiv = document.createElement('div');
        itemDiv.className = `log-item ${logClass}`;
        
        const date = new Date(item.timestamp);
        const timeStr = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        
        itemDiv.innerHTML = `
            <span>${timeStr} - ${isWin ? 'GREEN' : 'RED'}</span>
            <span style="font-weight: bold;">${sign}${formatCurrency(item.amount)}</span>
            <button class="log-delete-btn" data-index="${index}" title="Excluir este registro">
                <span class="material-symbols-outlined" style="font-size: 16px;">close</span>
            </button>
        `;
        bankrollHistoryDiv.appendChild(itemDiv);
    });

    bankrollHistoryDiv.querySelectorAll('.log-delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index, 10);
            deleteBankrollEntry(index);
        });
    });
  }
  
  function deleteBankrollEntry(index) {
    if (confirm('Tem certeza que deseja excluir este registro? Isso afetar√° sua banca e estat√≠sticas.')) {
        const deletedEntry = bankrollState.history[index];
        bankrollState.current = safeMath(bankrollState.current - deletedEntry.amount);
        bankrollState.history.splice(index, 1);
        saveBankrollData();
        updateUI();
        checkStopCondition();
    }
  }

  function renderGrid() {
    gridNumbers.innerHTML = '';
    
    const allNumbers = [...Array(37).keys()]; // 0 a 36
    allNumbers.forEach(num => {
        const btn = document.createElement('button');
        btn.className = `number-btn ${getColor(num)}`;
        btn.textContent = num;
        btn.addEventListener('click', () => addNumber(num));
        gridNumbers.appendChild(btn);
    });
  }

  let sessionTimerInterval;
  function updateClock() {
    const now = new Date();
    const clockDiv = document.getElementById('clock');
    clockDiv.textContent = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    
    if (config.isLoggedIn && config.sessionStart > 0) {
        const elapsed = Date.now() - config.sessionStart;
        const totalSeconds = Math.floor(elapsed / 1000);
        const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
        const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
        sessionTimerDiv.textContent = `Sess√£o: ${hours}:${minutes}`;
    }
  }
  
  function updateUI() {
    checkLockStatus(); 
    if (!getLoginStatus() || config.isLocked) return;

    calculateStats(); 
    renderHistory();
    renderBankrollDashboard();
    renderBankrollHistory();
    renderLatestSuccessors();
    renderZoneAnalysis();
    
    // ‚≠êÔ∏è Chama a nova fun√ß√£o do Booster I.A.
    renderBetSuggestion(); 
    
    // Tend√™ncias
    hotColdDiv.innerHTML = `
        üî• Hot: <span style="font-weight: bold; color: var(--red);">${numberStats.hotList.join(', ') || '-'}</span>
        <br>
        ‚ùÑÔ∏è Cold: <span style="font-weight: bold; color: var(--accent-secondary);">${numberStats.coldList.join(', ') || '-'}</span>
    `;
  }
  
  /* ================== EVENT LISTENERS ================== */
  
  // Login
  document.getElementById('btnSignInReal').addEventListener('click', () => {
      if (authPwdInput.value === getPasswordHash()) {
          setLoginStatus(true, 'REAL');
          updateUI();
      } else {
          alert('Senha incorreta.');
          authPwdInput.value = '';
      }
  });
  document.getElementById('btnSignInDemo').addEventListener('click', () => {
      setLoginStatus(true, 'DEMO');
      updateUI();
  });
  document.getElementById('logoutBtn').addEventListener('click', () => {
      setLoginStatus(false, 'DEMO');
      updateUI();
  });
  
  // Banca
  document.getElementById('btnSetBankroll').addEventListener('click', () => {
    const amount = parseFloat(initialBankrollInput.value);
    if (isNaN(amount) || amount <= 0) {
        alert('Por favor, insira um valor inicial de banca v√°lido (maior que zero).');
        return;
    }
    bankrollState.initial = safeMath(amount);
    bankrollState.current = safeMath(amount);
    bankrollState.history = []; // Limpa o hist√≥rico ao redefinir
    saveBankrollData();
    updateUI();
  });

  function registerTransaction(type) {
    if (bankrollState.initial === 0) {
        alert('Defina a Banca Inicial primeiro.');
        return;
    }
    const input = parseFloat(betAmountInput.value);
    if (isNaN(input) || input <= 0) {
        alert('Insira um valor v√°lido para o ganho/perda (maior que zero).');
        return;
    }
    
    const amount = safeMath(type === 'win' ? input : -input);
    
    bankrollState.current = safeMath(bankrollState.current + amount);
    bankrollState.history.push({
        amount: amount,
        timestamp: Date.now()
    });
    
    betAmountInput.value = ''; 
    saveBankrollData();
    updateUI();
    checkStopCondition();
  }

  btnRegisterWin.addEventListener('click', () => registerTransaction('win'));
  btnRegisterLoss.addEventListener('click', () => registerTransaction('loss'));
  
  // Hist√≥rico
  clearBtn.addEventListener('click', () => {
    if (confirm('Tem certeza que deseja limpar todo o Hist√≥rico de N√∫meros?')) {
        historyArr = [];
        // Limpa estado do Booster
        config.boosterConfirmations = 0;
        config.boosterIsLocked = false;
        delete config.boosterBetZone;
        delete config.boosterTriggerNum;
        saveConfig();
        
        saveHistoryData();
        updateUI();
    }
  });

  // Upload/OCR
  btnUpload.addEventListener('click', () => { uploadPhotoInput.click(); });

  uploadPhotoInput.addEventListener('change', async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    alert('Iniciando an√°lise OCR da imagem. Isso pode levar alguns segundos...');
    
    try {
        const { data: { text } } = await Tesseract.recognize(
            file,
            'eng', // Usamos 'eng' que funciona bem para n√∫meros
            {
                tessedit_char_whitelist: '0123456789 ',
                logger: m => console.log(m)
            }
        );
        
        // Extrai todos os n√∫meros sequenciais da string
        const numbersFound = text.match(/\d+/g); 
        
        if (numbersFound && numbersFound.length > 0) {
            const uniqueNumbers = numbersFound
                .map(n => parseInt(n, 10))
                .filter(n => !isNaN(n) && n >= 0 && n <= 36);

            if (uniqueNumbers.length > 0) {
                 const confirmation = confirm(`N√∫meros identificados na imagem (do mais recente para o mais antigo, se a ordem estiver correta): ${uniqueNumbers.join(', ')}. Adicionar ao hist√≥rico?`);
                 if (confirmation) {
                     addMultipleNumbers(uniqueNumbers);
                 }
            } else {
                alert('OCR n√£o conseguiu identificar n√∫meros v√°lidos (0-36).');
            }
        } else {
            alert('Nenhum n√∫mero encontrado pelo OCR.');
        }

    } catch (error) {
        console.error('OCR Error:', error);
        alert('Erro ao processar a imagem com OCR.');
    } finally {
        // Limpa o input para permitir upload do mesmo arquivo novamente
        uploadPhotoInput.value = '';
    }
  });
  
  // Bloqueio
  btnSkipLock.addEventListener('click', skipLock);
  
  // Inicializa√ß√£o
  loadConfig();
  loadHistoryData();
  loadBankrollData();
  renderGrid(); 
  updateUI();
  
  // Loop de rel√≥gio e timer
  setInterval(updateClock, 1000); 

  // Re-checar o Stop Condition e UI a cada 1 minuto (seguran√ßa)
  setInterval(updateUI, 60000); 

});
</script>

</body>
</html>
  --panel:#FFFFFF; /* Fundo do Card (Branco/Areia Clara) */
  --accent:#FFC300; /* Amarelo Ouro/Sol (Acento Principal) */
  --accent-secondary:#0079C0; /* Azul do Mar (Acento Secund√°rio) */
  --muted:#555555; /* Cinza Escuro Suave (Texto Comum) */
  --zero:#FF8C00; /* Laranja Forte/Gold (Zero) */
  --red:#B70404; /* Vermelho Vibrante */
  --black:#17202A; /* Azul Escuro/Carv√£o (Para n√∫meros e inputs) */
  --btn-main:linear-gradient(90deg, var(--accent), var(--accent-secondary)); 
  --alert-red:#D83C3C;
  --alert-green:#00A859; /* Verde Bandeira */
  --lock-bg:rgba(255, 255, 255, 0.95); /* Bloqueio Claro com Blur */

  --status-pending: #FFC300; /* Laranja para Pendente */
  --status-success: var(--alert-green); /* Verde para Sucesso */
  --status-fail: var(--alert-red); /* Vermelho para Falha */
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Roboto',sans-serif; /* Fonte mais clean para leitura */
  background:var(--bg);
  color:#17202A; /* Texto escuro no fundo claro */
  padding:14px;
}
.hidden { display: none !important; }

/* Corre√ß√£o da Tela de Login: impede rolagem */
body.login-active {
    height: 100vh;
    overflow: hidden;
}

/* ================== TELA DE LOGIN ================== */
#loginScreen {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    position: fixed; 
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    z-index: 8000; 
}
#loginBox {
    background: var(--panel);
    border-radius: 12px;
    padding: 30px;
    max-width: 400px;
    width: 100%;
    /* Novo Box Shadow mais tropical */
    box-shadow: 0 0 40px rgba(0, 121, 192, 0.1), 0 5px 15px rgba(0,0,0,0.1); 
    border: 1px solid rgba(0, 121, 192, 0.2);
    text-align: center;
}
.login-title{
    font-family:'Passion One', cursive; /* Fonte vibrante para t√≠tulos */
    font-weight: 700;
    font-size: 32px;
    color: var(--accent);
    margin-bottom: 5px;
    text-shadow: 0 0 5px rgba(255, 195, 0, 0.5);
}
.login-subtitle {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 25px;
}
#authPwd{
    width: 100%;
    padding: 12px;
    background: #F0F0F0; /* Fundo do input mais claro */
    border: 1px solid var(--accent-secondary);
    border-radius: 6px;
    color: var(--black);
    font-family: 'Roboto', sans-serif; /* Mantido como leitura */
    font-size: 16px;
    transition: border-color 0.2s, box-shadow 0.2s;
    margin-top: 15px;
}
#authPwd:focus {
    outline: none;
    border-color: var(--zero);
    box-shadow: 0 0 10px rgba(255,140,0,0.5);
    background: #fff;
}

/* ================== LAYOUT E COMPONENTES MODERNOS ================== */

/* Header / clock */
.header{
  /* Novo gradiente de Mar e Sol */
  background: linear-gradient(90deg, rgba(255,195,0,0.2), rgba(0,121,192,0.1)); 
  border-radius:8px; 
  padding:12px; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  box-shadow:0 0 15px rgba(0,0,0,0.1);
  border: 1px solid rgba(0,121,192,0.1);
}
.title{
  font-family:'Passion One', cursive;
  font-weight:700;
  font-size:24px;
  color: var(--accent-secondary); /* T√≠tulo em Azul do Mar */
  text-shadow: 0 0 5px rgba(0, 121, 192, 0.5);
}
#clock{
  color:var(--zero);
  font-family:'Passion One', cursive;
  font-weight:700;
  text-shadow:0 0 8px rgba(255,140,0,0.5);
}
#sessionTimer{
    font-size: 10px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    margin-left: 10px;
}

/* card */
.card{
  background:var(--panel);
  border-radius:12px;
  padding:15px;
  margin-top:14px;
  /* Sombra mais suave */
  box-shadow:0 5px 20px rgba(0,0,0,0.1), inset 0 0 8px rgba(0,121,192,0.05); 
  border:1px solid rgba(0,121,192,0.1);
  transition: all 0.3s ease;
}

/* T√≠tulos / Sugest√µes */
.suggestionTitle{
  font-family:'Passion One', cursive;
  font-weight:700;
  color:var(--accent); /* T√≠tulos em Amarelo Sol */
  margin-bottom:8px;
  display: flex;
  align-items: center;
  gap: 8px;
  border-bottom: 1px dashed rgba(0, 121, 192, 0.3);
  padding-bottom: 5px;
}
.suggestionBox{
  font-size:15px;
  color:var(--black); /* Texto escuro */
  line-height:1.7;
}
.iaGlow{
  color:var(--accent-secondary); /* Cor secund√°ria para o Booster */
  text-shadow:0 0 10px rgba(0, 121, 192, 0.6);
  /* Brilho mais suave */
  animation:glowPulse 2s infinite alternate;
}
@keyframes glowPulse{
  0%{text-shadow:0 0 3px rgba(0, 121, 192, 0.2)}
  100%{text-shadow:0 0 10px rgba(0, 121, 192, 0.8)}
}

.data-separator {
  height: 1px;
  /* Gradiente de Sol para Mar */
  background: linear-gradient(90deg, var(--accent), var(--accent-secondary), rgba(0,0,0,0));
  margin: 12px 0;
  opacity: 0.7;
}

/* ================== BOT√ïES E INPUTS ================== */

/* grid numbers */
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
  gap:8px;
  justify-content:center;
  margin-top: 10px;
}
.number-btn{
  width:100%; height:45px;
  border-radius:8px;
  border:1px solid rgba(0, 0, 0, 0.1);
  font-family:'Passion One', cursive;
  font-weight:700;
  cursor:pointer;
  transition:transform .14s,box-shadow .14s, border-color 0.14s;
  color: var(--black); /* Texto escuro */
}
.number-btn:hover{
    transform:scale(1.05); 
    box-shadow:0 0 15px rgba(0,121,192,0.4);
    border-color: var(--accent-secondary);
}
.number-btn:active{transform:scale(0.95); }
.red{background:var(--red);color:#fff}
.black{background:var(--black);color:#fff}
.zero, .green {background:var(--zero);color:var(--black)} 

/* Bot√µes de controle */
.control-btn{
  background:var(--btn-main);
  border:0;
  border-radius:6px;
  padding:12px 14px;
  color:#fff; /* Texto branco no gradiente */
  font-weight:700;
  font-family:'Passion One', cursive;
  cursor:pointer;
  transition: all .2s;
  margin: 4px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  text-transform: uppercase;
  display: flex; /* Para alinhar o √≠cone */
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.control-btn:hover{
    opacity:0.95; 
    box-shadow: 0 0 15px rgba(255,195,0,0.8);
    transform: translateY(-2px);
}
.control-btn:active{transform: translateY(1px);}
.control-btn:disabled { 
    opacity: 0.3; 
    cursor: not-allowed; 
    box-shadow: none; 
}


.btn-win { background: var(--alert-green); color: #fff; }
.btn-loss { background: var(--alert-red); color: #fff; }

/* Estilos de Entrada (Input) */
.bankroll-label {
    font-size: 11px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    margin-bottom: 4px;
    margin-top: 8px;
}
.bankroll-input {
    width: 100%;
    padding: 10px;
    background: #F0F8FF; /* Fundo do input mais claro */
    border: 1px solid var(--accent-secondary);
    border-radius: 6px;
    color: var(--black);
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    transition: border-color 0.2s;
}
.bankroll-input:focus {
    outline: none;
    border-color: var(--zero);
    box-shadow: 0 0 8px rgba(255,140,0,0.5);
    background: #fff;
}

/* ================== AN√ÅLISE E DASHBOARD DE BANCA ================== */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 15px;
    margin-top: 10px;
    padding-top: 10px;
}
.stat-item {
    background: #F0F8FF; /* Fundo do stat item mais suave */
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid var(--accent-secondary);
    box-shadow: inset 0 0 5px rgba(0, 121, 192, 0.1);
}
.stat-title {
    font-size: 11px;
    color: var(--muted);
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    margin-bottom: 5px;
}
.stat-value {
    font-size: 18px;
    font-weight: 700;
    font-family: 'Passion One', cursive;
    color: var(--black);
}
.positive { color: var(--alert-green) !important; text-shadow: 0 0 3px rgba(0, 168, 89, 0.5);}
.negative { color: var(--alert-red) !important; text-shadow: 0 0 3px rgba(216, 60, 60, 0.5);}

/* Hist√≥ria de Padr√µes (Chips) - ALTERADO PARA LINHA √öNICA */
.history{
    display: flex;
    flex-wrap: nowrap;
    gap: 8px;
    margin-top: 10px;
    max-width: 100%;
    overflow-x: auto;
    padding: 8px 5px;
    background: rgba(0,0,0,0.1); /* Fundo da hist√≥ria mais claro */
    border-radius: 6px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; 
}
.history::-webkit-scrollbar {
    display: none; 
}
.chip{
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
    border: 1px solid rgba(0,0,0,0.2);
    transition: transform 0.1s;
    font-family: 'Passion One', cursive;
}
.chip:hover { transform: scale(1.15); box-shadow: 0 0 10px var(--accent-secondary);}
.chip.zero { background: var(--zero); color: var(--black); }
.chip.red { background: var(--red); color: #fff; }
.chip.black { background: var(--black); color: #fff; border-color: rgba(255,255,255,0.5);}

/* An√°lise de Padr√µes/Tabela */
.analysis-output {
    background: #F0F8FF; 
    border: 1px solid var(--accent-secondary);
    border-radius: 8px;
    padding: 12px;
    box-shadow: inset 0 0 5px rgba(0, 121, 192, 0.1);
}
.pattern-line {
    font-size: 14px;
    margin-bottom: 6px;
    line-height: 1.4;
    color: var(--black);
}
.pattern-trigger {
    color: var(--zero);
    font-weight: bold;
    font-family: 'Passion One', cursive;
}
.pattern-succession {
    color: var(--accent);
    font-weight: bold;
}
.pattern-count {
    color: var(--muted);
    font-size: 12px;
}

/* Extrato */
#bankrollHistory {
    max-height: 150px;
    overflow-y: auto;
    padding: 5px;
    background: rgba(0,0,0,0.1); 
    border-radius: 6px;
}
.log-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    margin-bottom: 4px;
    border-radius: 4px;
    font-size: 14px;
    transition: background 0.2s;
}
.log-win { background: rgba(0, 168, 89, 0.1); border-left: 3px solid var(--alert-green); color: var(--alert-green);}
.log-loss { background: rgba(216, 60, 60, 0.1); border-left: 3px solid var(--alert-red); color: var(--alert-red);}
.log-delete-btn {
    background: none;
    border: none;
    color: var(--muted);
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s;
}
.log-delete-btn:hover { color: var(--black); }

/* ================== TELA DE BLOQUEIO (CADEADO) ================== */

#lockScreen{
  position:fixed;
  inset:0;
  background:var(--lock-bg);
  backdrop-filter: blur(6px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9000;
  text-align:center;
}
#lockScreen svg {
    color: var(--alert-red);
    margin-bottom: 10px;
}
#lockScreen h2{
  font-family:'Passion One', cursive;
  color:var(--alert-red);
  font-size:32px;
}
#lockScreen h2.win {
  color:var(--alert-green);
}
#lockScreen p{
  font-size:18px;
  color:var(--muted);
  margin-top: 10px;
}
#lockScreen .countdown{
  font-family:'Passion One', cursive;
  font-size:52px;
  font-weight:700;
  color:var(--accent-secondary);
  margin-top:20px;
  margin-bottom: 25px;
  text-shadow: 0 0 15px rgba(0, 121, 192, 0.8);
}
/* Novo estilo para a sugest√£o final */
.bet-zone-list {
    font-size: 20px;
    font-weight: 700;
    color: var(--alert-green);
    text-shadow: 0 0 10px rgba(0, 168, 89, 0.6);
    border: 2px solid var(--alert-green);
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    line-height: 1.5;
}

/* ================== ANIMA√á√ÉO DE CONFIRMA√á√ÉO ================== */

.confirmation-animation {
    margin-top: 15px;
    padding: 10px;
    border: 1px dashed var(--muted);
    border-radius: 8px;
    font-size: 14px;
}

.conf-line {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 5px;
    font-weight: 700;
}
.conf-icon {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 10px;
    font-weight: 900;
    transition: background-color 0.5s;
    flex-shrink: 0;
}
.conf-pending { background-color: var(--status-pending); animation: pulse 1s infinite alternate; }
.conf-success { background-color: var(--status-success); }
.conf-fail { background-color: var(--status-fail); }

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 195, 0, 0.7); }
    100% { box-shadow: 0 0 0 5px rgba(255, 195, 0, 0); }
}

.status-text-ready {
    color: var(--status-success);
    font-size: 1.5em;
    font-family: 'Passion One', cursive;
    text-shadow: 0 0 5px var(--status-success);
}
.status-text-fail {
    color: var(--status-fail);
    font-size: 1.3em;
    font-weight: 700;
}

</style>
</head>
<body id="bodyTag">

<div id="lockScreen" class="hidden">
  <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" fill="currentColor" viewBox="0 0 16 16" id="lockIcon">
    <path d="M8 1a2 2 0 0 0-2 2v4h4V3a2 2 0 0 0-2-2m3 6V3a3 3 0 1 0-6 0v4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1zM4 8a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5z"/>
  </svg>
  <h2 id="lockTitle">ZONA SEGURA ATINGIDA (STOP LOSS)</h2>
  <p>An√°lise bloqueada. Retorne ap√≥s o per√≠odo de resfriamento:</p>
  <div class="countdown" id="countdownTimer">02:00:00</div>
  
  <button id="btnSkipLock" class="control-btn" 
          style="margin-top: 30px; background: #6c757d; font-size: 16px;">
      <span class="material-symbols-outlined">lock_open</span>
      PULAR BLOQUEIO (QUEBRAR REGRA)
  </button>
</div>


<div id="loginScreen"> 
  <div id="loginBox">
    <div class="login-title">IAP BRASIL üáßüá∑</div>
    <div class="login-subtitle">Interface de An√°lise de Padr√µes</div>

    <div id="signInForm">
      <input id="authPwd" type="password" placeholder="Senha de Acesso (Modo Real)" autocomplete="current-password" required><br>
      
      <div style="display:flex; gap:10px; margin-top:15px;">
          <button id="btnSignInReal" class="control-btn" style="flex:1; background: linear-gradient(90deg, #ffc400, #ff8c00); color: var(--black);">MODO REAL</button>
          <button id="btnSignInDemo" class="control-btn" style="flex:1; background: var(--btn-main); color: #fff;">MODO DEMO</button>
      </div>
      
    </div>
    
  </div>
</div>

<div id="mainPanel" class="hidden">
  <div class="header">
    <div style="display: flex; align-items: center;">
        <div class="title">IAP BRASIL</div>
        <div id="sessionTimer">Sess√£o: -:-</div>
    </div>
    <div id="clock">--:--:--</div>
  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">payments</span>
        GEST√ÉO DE BANCA E RISCO
    </div>
    
    <div class="bankroll-grid" style="display:flex; gap: 15px;">
        <div style="flex:1;">
            <div class="bankroll-label">BANCA INICIAL (R$)</div>
            <input id="initialBankrollInput" type="number" class="bankroll-input" placeholder="1000" min="0" step="0.01">
            <button id="btnSetBankroll" class="control-btn" style="width: 100%; margin-top: 8px;">
                <span class="material-symbols-outlined">account_balance</span>
                DEFINIR BANCA
            </button>
        </div>
        <div class="bankroll-actions" style="flex:1;">
            <div class="bankroll-label">REGISTRAR ENTRADA (R$)</div>
            <input id="betAmountInput" type="number" class="bankroll-input" placeholder="Valor ganho/perdido" min="0" step="0.01">
            <div style="display:flex; gap: 8px;">
                <button id="btnRegisterWin" class="control-btn btn-win" style="flex:1; margin-top: 8px;">GREEN (+)</button>
                <button id="btnRegisterLoss" class="control-btn btn-loss" style="flex:1; margin-top: 8px;">RED (-)</button>
            </div>
        </div>
    </div>
    
    <div class="data-separator"></div>
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">monitoring</span>
        ESTAT√çSTICAS DE DESEMPENHO
    </div>
    <div id="performanceDashboard" class="dashboard-grid">
      <span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>
    </div>

  </div>

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">receipt_long</span>
        EXTRATO DE TRANSA√á√ïES
    </div>
    <div id="bankrollHistory" class="bankroll-history-list">
      <div class="log-item log-placeholder">Nenhum registro ainda.</div>
    </div>
  </div>
  
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="suggestionTitle history-title">
        <span class="material-symbols-outlined">history</span>
        HIST√ìRICO DA ROLETA <span id="historyCount" class="history-subtitle">0/100</span>
      </div>
      <div class="history-subtitle" style="font-size:11px;color:var(--muted)">Recentes ‚Üí Antigos (Scroll)</div> 
    </div>
    <div id="history" class="history"></div>
  </div>
  

  <div class="card">
    <div class="suggestionTitle">
        <span class="material-symbols-outlined">dialpad</span>
        ENTRADAS R√ÅPIDAS
    </div>
    <div class="grid" id="gridNumbers"></div>
    <div class="data-separator"></div>
    <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <button id="btnUpload" class="control-btn" style="flex:1 1 150px;">
            <span class="material-symbols-outlined">camera_alt</span>
            üì∏ Enviar foto
        </button> 
        <button id="clearBtn" class="control-btn btn-loss" title="Limpar hist√≥rico" style="flex:1 1 100px;">
            <span class="material-symbols-outlined">delete</span>
            LIMPAR
        </button>
        <button id="logoutBtn" class="control-btn control-logout" title="Sair" style="flex:1 1 100px;">
            <span class="material-symbols-outlined">logout</span>
            SAIR
        </button>
    </div>
  </div>
  
  <div class="card" id="latestSuccessorsCard" style="display:none;">
    <div class="suggestionTitle" style="color: var(--accent-secondary); border-bottom-color: var(--accent-secondary);">
        <span class="material-symbols-outlined">repeat</span>
        √öLTIMOS SUCESSORES DO GATILHO (<span id="successorTriggerNum" style="font-weight: 700;">-</span>)
    </div>
    <div id="latestSuccessorsList" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
        <span style="color:var(--muted)">Adicione n√∫meros ao hist√≥rico para ver os sucessores.</span>
    </div>
  </div>
  <div class="card">
    <div class="analysis-wrapper">
      <div class="analysis-main">
        <div class="suggestionTitle">
            <span class="material-symbols-outlined">auto_fix</span>
            SUCESS√ÉO DE ZONAS (ZONA 5)
        </div>
        <div id="zoneAnalysis" class="suggestionBox">Adicione n√∫meros ao hist√≥rico para an√°lise de Zonas.</div>
      </div>
      <div class="analysis-hot-cold" style="margin-top:15px;">
        <div class="suggestionTitle">
            <span class="material-symbols-outlined">thermometer</span>
            TEND√äNCIAS GERAIS
        </div>
        <div id="hotCold" class="suggestionBox">üî• Hot: -<br>‚ùÑÔ∏è Cold: -</div>
      </div>
    </div>
  </div>

  <div class="card" id="boosterCard">
    <div class="suggestionTitle iaGlow">
        <span class="material-symbols-outlined">magic_button</span>
        BOOSTER DE APOSTA I.A.
    </div>
    <div id="betSuggestion" class="suggestionBox" style="font-size: 16px; font-weight: 700;">
        <span style="color:var(--muted)">Aguardando dados ou aguardando desbloqueio...</span>
    </div>
  </div>
  
  <input type="file" id="uploadPhoto" accept="image/*" class="hidden">
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ================== CONSTANTES DE CONFIGURA√á√ÉO ================== */
  // --- SENHA ALTERADA PARA 2025 ---
  const getPasswordHash = () => '2025'; 
  // ---------------------------------
  const BANKROLL_STORAGE_KEY = 'roletaIAPBankroll_main';
  const HISTORY_STORAGE_KEY = 'roletaIAPHistory'; 
  const CONFIG_STORAGE_KEY = 'roletaIAPConfig'; 
  
  const WHEEL_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
  const WHEEL_INDEX_MAP = {};
  WHEEL_ORDER.forEach((num, index) => { WHEEL_INDEX_MAP[num] = index; });

  const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36]);
  
  // Constantes de Stop Loss/Win/Sess√£o
  const STOP_LOSS_COUNT = 2; // 2 REDs consecutivos
  const STOP_LOSS_AMOUNT = 35.00; // R$35,00 de preju√≠zo total
  const STOP_WIN_COUNT = 3; // 3 WINs consecutivos
  const STOP_WIN_AMOUNT = 35.00; // R$35,00 de lucro total
  const LOCK_DURATION = 2 * 60 * 60 * 1000; // 2 horas em milis

  /* =========================================================================================
   * CONFIGURA√á√ïES ESPEC√çFICAS DO BOOSTER I.A. (Quebra de Sucess√£o)
   ========================================================================================= */
  const SUCCESSOR_LOOKBACK = 100; 
  const MIN_HISTORY_FOR_BOOSTER = 10; 
  const SUCCESSOR_DISPLAY_LIMIT = 10; 
  const CONFIRMATION_ROUNDS = 4; // M√≠nimo de repeti√ß√µes do Gatilho como predecessor.
  const CONFIRMATION_ROUNDS_UI = 3; // NOVO: Quantas confirma√ß√µes de "fora da zona" s√£o necess√°rias.


  
  /* ================== ELEMENTOS DOM (Mantidos) ================== */
  const bodyTag = document.getElementById('bodyTag');
  const loginScreen = document.getElementById('loginScreen');
  const mainPanel = document.getElementById('mainPanel');
  const lockScreen = document.getElementById('lockScreen');
  const lockTitle = document.getElementById('lockTitle');
  const countdownTimer = document.getElementById('countdownTimer');
  const btnSkipLock = document.getElementById('btnSkipLock');
  const sessionTimerDiv = document.getElementById('sessionTimer'); 
  const boosterCard = document.getElementById('boosterCard');
  
  const historyDiv = document.getElementById('history');
  const historyCount = document.getElementById('historyCount');
  const zoneAnalysisDiv = document.getElementById('zoneAnalysis');
  const hotColdDiv = document.getElementById('hotCold');
  const betSuggestionDiv = document.getElementById('betSuggestion'); 
  const gridNumbers = document.getElementById('gridNumbers');
  
  const latestSuccessorsCard = document.getElementById('latestSuccessorsCard');
  const latestSuccessorsList = document.getElementById('latestSuccessorsList');
  const successorTriggerNumDiv = document.getElementById('successorTriggerNum');


  const btnRegisterWin = document.getElementById('btnRegisterWin');
  const btnRegisterLoss = document.getElementById('btnRegisterLoss');
  const betAmountInput = document.getElementById('betAmountInput');
  const initialBankrollInput = document.getElementById('initialBankrollInput');
  const bankrollHistoryDiv = document.getElementById('bankrollHistory');
  const authPwdInput = document.getElementById('authPwd');
  const btnUpload = document.getElementById('btnUpload'); 
  const uploadPhotoInput = document.getElementById('uploadPhoto');
  const clearBtn = document.getElementById('clearBtn');
  
  /* ================== ESTADO DA APLICA√á√ÉO ================== */
  let historyArr = []; 
  let numberStats = {}; 
  let config = {
      mode: 'DEMO', 
      isLoggedIn: false, 
      isLocked: false,
      lockUntil: 0,
      lockReason: '', 
      sessionStart: 0, 
      boosterConfirmations: 0, // NOVO: Contador de confirma√ß√µes de "fora da zona"
  };
  
  let bankrollState = {
    initial: 0,
    current: 0,
    history: [] 
  };
  const MAX_HISTORY = 100;
  
  /* ================== UTILIT√ÅRIOS OTIMIZADOS ================== */
  const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2 });
  function getColor(num) {
    if (num === 0) return 'zero';
    if (RED_NUMBERS.has(num)) return 'red';
    return 'black';
  }
  
  const safeMath = (num) => parseFloat(num.toFixed(2));


  /**
   * Obt√©m vizinhos de um n√∫mero com um raio espec√≠fico.
   */
  function getNeighbors(centerNum, radius) {
    const centerIndex = WHEEL_INDEX_MAP[centerNum];
    const neighbors = [];
    const len = WHEEL_ORDER.length;

    for (let i = -radius; i <= radius; i++) {
        const index = (centerIndex + i + len) % len;
        neighbors.push(WHEEL_ORDER[index]);
    }
    return neighbors; 
  }
  
  /* ================== PERSIST√äNCIA E SESS√ÉO ================== */
  
  function saveConfig() {
    localStorage.setItem(CONFIG_STORAGE_KEY, JSON.stringify(config));
  }
  function loadConfig() {
    try {
        const savedConfig = localStorage.getItem(CONFIG_STORAGE_KEY);
        if (savedConfig) {
          const loaded = JSON.parse(savedConfig);
          config.mode = loaded.mode || 'DEMO';
          config.isLoggedIn = loaded.isLoggedIn || false; 
          config.isLocked = loaded.isLocked || false;
          config.lockUntil = loaded.lockUntil || 0;
          config.lockReason = loaded.lockReason || '';
          config.sessionStart = loaded.sessionStart || 0;
          config.boosterConfirmations = loaded.boosterConfirmations || 0; // NOVO
        }
    } catch (e) {
        console.error("Erro ao carregar configura√ß√£o:", e);
    }
  }
  
  function setLoginStatus(isLoggedIn, mode = 'DEMO') {
      config.isLoggedIn = isLoggedIn;
      config.mode = mode; 
          
      if (isLoggedIn) {
          config.sessionStart = Date.now();
      } else {
          config.sessionStart = 0; 
      }
      saveConfig();
  }

  function getLoginStatus() {
      return config.isLoggedIn; 
  }
  
  /* ================== L√ìGICA DE BLOQUEIO / STOP / SESS√ÉO ================== */

  let countdownInterval;

  function checkLockStatus() {
      const now = Date.now();
      
      // 1. Verifica se o bloqueio existente terminou
      if (config.isLocked && config.lockUntil > now) {
          lockScreen.classList.remove('hidden');
          mainPanel.classList.add('hidden');
          bodyTag.classList.remove('login-active'); 
          
          let titleText = '';
          if (config.lockReason === 'STOP_LOSS') { titleText = 'ZONA SEGURA ATINGIDA (STOP LOSS)'; }
          else if (config.lockReason === 'STOP_WIN') { titleText = 'ZONA SEGURA ATINGIDA (STOP WIN)'; }
          else if (config.lockReason === 'SKIPPED') { titleText = 'BLOQUEIO INTERROMPIDO'; } 

          lockTitle.textContent = titleText;
          lockTitle.classList.toggle('win', config.lockReason === 'STOP_WIN');
          document.getElementById('lockIcon').style.color = (config.lockReason === 'STOP_WIN') ? 'var(--alert-green)' : 'var(--alert-red)';

          startLockCountdown();
          return true; 
      }

      // 2. Se o bloqueio terminou (ou n√£o existia), desbloqueia/mant√©m desbloqueado
      if (config.isLocked && config.lockUntil <= now) {
          // Bloqueio terminou! Resetamos o estado.
          config.isLocked = false;
          config.lockUntil = 0;
          config.lockReason = '';
          
          // **AJUSTE CR√çTICO**: Reset da banca e do hist√≥rico de transa√ß√µes.
          if (bankrollState.initial > 0) {
            bankrollState.initial = bankrollState.current; 
            bankrollState.history = []; // RESET DO HIST√ìRICO PARA NOVO CICLO
            saveBankrollData();
          }

          config.sessionStart = Date.now(); 
          saveConfig();
      }
      
      // 3. Estado Desbloqueado e Logado
      lockScreen.classList.add('hidden');
      if (getLoginStatus()) {
          mainPanel.classList.remove('hidden');
          loginScreen.classList.add('hidden');
          bodyTag.classList.remove('login-active');
          sessionTimerDiv.textContent = `Sess√£o: -:-`; 
      } else {
          // N√£o logado
          loginScreen.classList.remove('hidden');
          mainPanel.classList.add('hidden');
          bodyTag.classList.add('login-active'); 
      }
      stopLockCountdown();
      return false; 
  }
  
  function startLockCountdown() {
      stopLockCountdown(); 
      
      countdownInterval = setInterval(() => {
          const remainingTime = config.lockUntil - Date.now();
          if (remainingTime <= 0) {
              checkLockStatus(); 
              return;
          }

          const totalSeconds = Math.floor(remainingTime / 1000);
          const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
          const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
          const seconds = String(totalSeconds % 60).padStart(2, '0');
          
          countdownTimer.textContent = `${hours}:${minutes}:${seconds}`;

      }, 1000);
  }

  function stopLockCountdown() {
      if (countdownInterval) {
          clearInterval(countdownInterval);
          countdownInterval = null; 
      }
  }
  
  function triggerLock(reason) {
      if (config.mode !== 'REAL') return;

      config.isLocked = true;
      config.lockUntil = Date.now() + LOCK_DURATION;
      config.lockReason = reason;
      saveConfig();
      
      checkLockStatus();
  }
  
  function skipLock() {
    if (!config.isLocked) return;

    if (confirm('ATEN√á√ÉO! Voc√™ est√° prestes a quebrar a regra de Stop Loss/Win. Isso pode comprometer sua gest√£o de risco. Tem certeza que deseja pular o bloqueio?')) {
        config.lockUntil = Date.now() - 1; 
        config.isLocked = false;
        config.lockReason = 'SKIPPED';
        saveConfig();
        
        if (bankrollState.initial > 0) {
            bankrollState.initial = bankrollState.current; 
            bankrollState.history = []; 
            saveBankrollData();
        }

        config.sessionStart = Date.now(); 
        stopLockCountdown(); 
        checkLockStatus(); 
        updateUI(); 
    }
}

  function checkStopCondition() {
      if (config.mode !== 'REAL' || config.isLocked || bankrollState.initial === 0) return;

      const { current, initial, history } = bankrollState;
      const totalProfit = safeMath(current - initial); 
      
      if (totalProfit <= -STOP_LOSS_AMOUNT) {
          triggerLock('STOP_LOSS');
          return;
      }
      if (totalProfit >= STOP_WIN_AMOUNT) {
          triggerLock('STOP_WIN');
          return;
      }
      
      let consecutiveLoss = 0;
      let consecutiveWin = 0;
      
      for (let i = history.length - 1; i >= 0; i--) {
          const amount = history[i].amount;
          
          if (amount === 0) continue; 
          
          if (amount < 0) {
              consecutiveLoss++;
              consecutiveWin = 0; 
          } else if (amount > 0) {
              consecutiveWin++;
              consecutiveLoss = 0; 
          }
          
          if (consecutiveLoss >= STOP_LOSS_COUNT) {
              triggerLock('STOP_LOSS');
              return;
          }
          if (consecutiveWin >= STOP_WIN_COUNT) {
              triggerLock('STOP_WIN');
              return;
          }
      }
  }

  function saveBankrollData() {
    localStorage.setItem(BANKROLL_STORAGE_KEY, JSON.stringify(bankrollState));
  }
  function loadBankrollData() {
    try {
        const savedData = localStorage.getItem(BANKROLL_STORAGE_KEY);
        if (savedData) {
          bankrollState = JSON.parse(savedData);
          bankrollState.initial = safeMath(bankrollState.initial || 0); 
          bankrollState.current = safeMath(bankrollState.current || 0); 
          bankrollState.history = bankrollState.history || [];
          bankrollState.history = bankrollState.history.map(item => ({
              amount: safeMath(item.amount),
              timestamp: item.timestamp 
          }));
        } else {
          bankrollState = { initial: 0, current: 0, history: [] };
        }
        initialBankrollInput.value = bankrollState.initial > 0 ? bankrollState.initial : '';
    } catch (e) {
        console.error("Erro ao carregar dados da Banca:", e);
    }
  }

  function saveHistoryData() {
    localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(historyArr));
  }
  function loadHistoryData() {
    try {
        const savedHistory = localStorage.getItem(HISTORY_STORAGE_KEY);
        if (savedHistory) {
          historyArr = JSON.parse(savedHistory)
            .map(n => parseInt(n, 10))
            .filter(n => !isNaN(n) && n >= 0 && n <= 36);
        } else {
          historyArr = [];
        }
    } catch (e) {
        console.error("Erro ao carregar Hist√≥rico:", e);
    }
  }

  function calculateStats() {
    const allNumbers = [...Array(37).keys()]; 
    const stats = {
      counts: {},
      zoneSuccessionMap: {}, 
      hotList: [],
      coldList: [],
    };
    allNumbers.forEach(n => { stats.counts[n] = { count: 0 }; });

    for (let i = 0; i < historyArr.length; i++) {
      const currentNum = historyArr[i];
      stats.counts[currentNum].count++;
      
      if (i < historyArr.length - 1) {
        const nextNum = historyArr[i + 1]; 
        if (!stats.zoneSuccessionMap[currentNum]) { stats.zoneSuccessionMap[currentNum] = []; }
        stats.zoneSuccessionMap[currentNum].push(nextNum);
      }
    }
    
    const allCounts = allNumbers.map(n => stats.counts[n].count);
    const avgCount = allCounts.length > 0 ? allCounts.reduce((a, b) => a + b, 0) / allCounts.length : 0;

    stats.hotList = allNumbers
      .filter(n => stats.counts[n].count > avgCount) 
      .sort((a, b) => stats.counts[b].count - stats.counts[a].count) 
      .slice(0, 4);
    
    stats.coldList = allNumbers
      .filter(n => stats.counts[n].count < avgCount)
      .sort((a, b) => stats.counts[a].count - stats.counts[b].count) 
      .slice(0, 4);

    numberStats = stats;
  }
  
  // ==================== L√ìGICA DE ADI√á√ÉO DE N√öMEROS (MODIFICADA) ====================
  
  function addNumber(num) {
    if (num < 0 || num > 36 || isNaN(num)) {
        console.error("Tentativa de adicionar n√∫mero inv√°lido:", num);
        return;
    }
    
    // --- L√ìGICA DE CONFIRMA√á√ÉO DO BOOSTER I.A. ---
    // 1. Verificar se a I.A. estava ativa e sugerindo uma aposta (config.boosterBetZone existe)
    if (config.boosterConfirmations < CONFIRMATION_ROUNDS_UI && config.boosterBetZone && config.boosterBetZone.length > 0) {
        const currentZone = config.boosterBetZone;
        const numberLandedInZone = currentZone.includes(Number(num));

        if (!numberLandedInZone) {
            // Confirmado: o n√∫mero caiu FORA da zona sugerida.
            config.boosterConfirmations++;
        } else {
            // Padr√£o Quebrado/Falha: o n√∫mero caiu DENTRO da zona.
            config.boosterConfirmations = 0; // Reset para avan√ßar para o pr√≥ximo padr√£o
            delete config.boosterBetZone; // Limpa a zona de aposta anterior
            delete config.boosterTriggerNum; // Limpa o Gatilho anterior
        }
        saveConfig();
    } 
    // Se as confirma√ß√µes chegaram a 3, elas ser√£o resetadas no renderBetSuggestion para indicar "Apostar" e liberar o pr√≥ximo ciclo.
    
    // ----------------------------------------------
    
    if (historyArr.length >= MAX_HISTORY) { historyArr.pop(); }
    historyArr.unshift(Number(num)); 
    saveHistoryData();
    updateUI(); 
  }
  
  function addMultipleNumbers(numArray) {
    const validNumbers = numArray
      .map(n => parseInt(n, 10))
      .filter(n => !isNaN(n) && n >= 0 && n <= 36);
      
    if (validNumbers.length === 0) {
        alert('Nenhum n√∫mero de 0 a 36 v√°lido identificado.');
        return;
    }
    
    const correctlyOrderedNumbers = validNumbers; 
    
    // Como a l√≥gica de confirma√ß√£o √© baseada no LANCE ANTERIOR, 
    // n√£o aplicaremos a l√≥gica de confirma√ß√£o aqui, apenas a adi√ß√£o.
    // A l√≥gica de confirma√ß√£o ser√° aplicada ao adicionar n√∫mero por n√∫mero.
    
    let numbersToAdd = [...correctlyOrderedNumbers];
    
    // Adiciona um por um para que a l√≥gica do addNumber (que √© baseada no ultimo lance) funcione corretamente.
    // Inverte para processar do mais antigo do lote para o mais recente do lote.
    numbersToAdd.reverse().forEach(n => {
         // Temporariamente desativamos a l√≥gica de confirma√ß√£o para o lote.
         // Sen√£o ter√≠amos que recriar toda a l√≥gica de estado intermedi√°rio aqui.
         // A confirma√ß√£o √© mais relevante para input em tempo real.
         
         // Limpamos o estado de confirma√ß√£o para evitar contagens estranhas em input de lote.
         config.boosterConfirmations = 0;
         delete config.boosterBetZone;
         delete config.boosterTriggerNum;
         saveConfig();
         
         if (historyArr.length >= MAX_HISTORY) { historyArr.pop(); }
         historyArr.unshift(Number(n)); 
    });
    
    saveHistoryData();
    updateUI();
  }

  function renderLatestSuccessors() {
    if (historyArr.length < 2) {
        latestSuccessorsCard.style.display = 'none';
        return;
    }

    const triggerNum = historyArr[0];
    const recentSuccessors = [];
    const limit = Math.min(historyArr.length - 1, SUCCESSOR_LOOKBACK);

    for (let i = 1; i <= limit; i++) {
        const predecessorNum = historyArr[i];
        const successorNum = historyArr[i - 1]; 
        
        if (predecessorNum === triggerNum) {
            recentSuccessors.push(successorNum);
        }
    }

    latestSuccessorsCard.style.display = 'block';
    successorTriggerNumDiv.textContent = triggerNum;
    latestSuccessorsList.innerHTML = ''; 

    if (recentSuccessors.length === 0) {
        latestSuccessorsList.innerHTML = `<span style="color:var(--muted)">O n√∫mero **${triggerNum}** n√£o se repetiu como predecessor nos √∫ltimos ${limit} lan√ßamentos.</span>`;
        return;
    }
    
    const displaySuccessors = recentSuccessors.slice(0, SUCCESSOR_DISPLAY_LIMIT); 
    
    let html = `
        <span style="color: var(--black); font-weight: 700; flex-shrink: 0;">Total: ${recentSuccessors.length}x</span>
    `;

    displaySuccessors.forEach((num, index) => {
        html += `<div class="chip ${getColor(num)}" 
                     style="width: 30px; height: 30px; font-size: 12px; font-weight: 700; flex-shrink: 0;" 
                     title="Ordem de Apari√ß√£o: ${index + 1}¬∫ mais recente (Recente ‚Üí Antigo)">
                     ${num}
                 </div>`;
    });
    
    if (recentSuccessors.length > SUCCESSOR_DISPLAY_LIMIT) {
         html += `<span style="font-size: 12px; color: var(--muted); align-self: flex-end; flex-shrink: 0;">...e mais ${recentSuccessors.length - SUCCESSOR_DISPLAY_LIMIT}</span>`;
    }

    latestSuccessorsList.innerHTML = html;
  }
  
  // ==================== L√ìGICA DE AN√ÅLISE DE SUCESS√ÉO DE ZONAS (Mantida) ====================
  function renderZoneAnalysis() {
    if (historyArr.length < 2) { 
      zoneAnalysisDiv.innerHTML = '<span style="color:var(--muted)">Adicione pelo menos 2 n√∫meros ao hist√≥rico para an√°lise de Sucess√£o de Zonas.</span>';
      return;
    }
    
    const LOOKBACK_ZONA = 100;
    const triggerNum = historyArr[0]; 
    const triggerZone = getNeighbors(triggerNum, 2); 
    
    const zoneFollowers = {};
    const lastAppearanceIndex = {}; 
    let totalOccurrences = 0;
    
    for (let i = 1; i < historyArr.length && i <= LOOKBACK_ZONA; i++) {
        const predecessorNum = historyArr[i];
        const successorNum = historyArr[i - 1];
        
        if (triggerZone.includes(predecessorNum)) {
            zoneFollowers[successorNum] = (zoneFollowers[successorNum] || 0) + 1;
            totalOccurrences++;
            
            if (!lastAppearanceIndex[successorNum] || i < lastAppearanceIndex[successorNum]) {
                lastAppearanceIndex[successorNum] = i; 
            }
        }
    }

    if (totalOccurrences === 0) { 
      zoneAnalysisDiv.innerHTML = `<span style="color:var(--muted)">A **Zona ${triggerNum}** (${triggerZone.join(', ')} ) n√£o teve ocorr√™ncias registradas como predecessor nos √∫ltimos ${Math.min(historyArr.length, LOOKBACK_ZONA)} lan√ßamentos.</span>`;
      return;
    }
    
    const processed = new Set();
    const successorGroups = [];

    for (const num of WHEEL_ORDER) {
        if (zoneFollowers[num] && !processed.has(num)) {
            let group = [num];
            let groupCount = zoneFollowers[num];
            processed.add(num);

            let currentIdx = WHEEL_INDEX_MAP[num];
            let groupLastAppearance = lastAppearanceIndex[num]; 

            let isContiguous = true;
            while (isContiguous) {
                let nextIdx = (currentIdx + 1) % WHEEL_ORDER.length;
                let nextNum = WHEEL_ORDER[nextIdx];
                
                if (zoneFollowers[nextNum] && !processed.has(nextNum)) {
                    group.push(nextNum);
                    groupCount += zoneFollowers[nextNum];
                    processed.add(nextNum);
                    currentIdx = nextIdx;
                    if (lastAppearanceIndex[nextNum] < groupLastAppearance) {
                        groupLastAppearance = lastAppearanceIndex[nextNum];
                    }
                } else {
                    isContiguous = false; 
                }
                
                if (group.length === WHEEL_ORDER.length) break; 
            }
            
            successorGroups.push({ 
                numbers: group, 
                count: groupCount,
                first: group[0],
                last: group[group.length - 1],
                recentIndex: groupLastAppearance 
            });
        }
    }

    successorGroups.sort((a, b) => {
        if (a.recentIndex !== b.recentIndex) {
            return a.recentIndex - b.recentIndex; 
        }
        return b.count - a.count; 
    });
    
    let html = `
        <div class="analysis-output">
            <div class="pattern-line">√öltimo lan√ßamento (GATILHO): <span class="pattern-trigger">${triggerNum}</span></div>
            <div class="pattern-line pattern-count">**ZONA DE AN√ÅLISE (5 N√∫meros):** <span style="font-weight: bold; color: var(--accent);">${triggerZone.join(', ')}</span></div>
            <div class="data-separator" style="margin: 8px 0;"></div>
    `;

    successorGroups.forEach(group => {
        const percentage = safeMath((group.count / totalOccurrences) * 100);
        html += `
            <div class="pattern-line">
                SUCESS√ÉO DE ${group.numbers.length} N√öMERO(S): 
                <span class="pattern-succession">${group.numbers.join(', ')}</span>
                <span class="pattern-count">(${group.count}x, ${percentage}%) | Mais recente: ${group.recentIndex}¬∫</span>
            </div>
        `;
    });
    
    html += '</div>';
    zoneAnalysisDiv.innerHTML = html;
  }
  
  
  // =========================================================================================
  // üöÄ C√ìDIGO DO BOOSTER I.A. (MODIFICADO COM L√ìGICA DE CONFIRMA√á√ÉO)
  // =========================================================================================

  /**
   * Calcula a Zona de Aposta com '2 Vizinhos' para cada n√∫mero sucessor.
   */
  function calculateBetZone(successors) {
    const finalZone = new Set();
    
    successors.forEach(num => {
      // Adiciona 2 vizinhos para cada lado (totalizando 5 n√∫meros: N-2, N-1, N, N+1, N+2)
      const neighbors = getNeighbors(num, 2); 
      neighbors.forEach(n => finalZone.add(n));
    });
    
    // Convertendo o Set para Array e ordenando.
    return Array.from(finalZone).sort((a, b) => a - b);
  }

  /**
   * Identifica os sucessores com base na confirma√ß√£o do gatilho.
   */
  function findBoosterSuccessors(triggerNum) {
    const allSuccessors = new Set();
    let triggerCount = 0;
    const limit = Math.min(historyArr.length - 1, SUCCESSOR_LOOKBACK);

    for (let i = 1; i <= limit; i++) {
        const predecessorNum = historyArr[i];
        const successorNum = historyArr[i - 1]; 
        
        if (predecessorNum === triggerNum) {
            triggerCount++;
            allSuccessors.add(successorNum); 
        }
    }
    
    if (triggerCount < CONFIRMATION_ROUNDS) {
        return { 
            triggerCount: triggerCount, 
            successors: [] 
        };
    }
    
    return { 
        triggerCount: triggerCount, 
        successors: Array.from(allSuccessors).map(n => parseInt(n, 10))
    };
  }
  
  /**
   * ‚öôÔ∏è Fun√ß√£o principal para renderizar a Sugest√£o de Aposta (Booster I.A.).
   */
  function renderBetSuggestion() {
    if (config.isLocked || historyArr.length < MIN_HISTORY_FOR_BOOSTER) {
        // ... (Mensagem de Bloqueio/Aguardando Dados - Sem altera√ß√£o)
        let msg = '<span style="color:var(--muted)">';
        if (config.isLocked) {
            msg += `‚õî **ANALISADOR BLOQUEADO:** Motivo: ${config.lockReason === 'STOP_LOSS' ? 'Stop Loss' : 'Stop Win'}.`;
        } else {
            msg += `‚è≥ **AGUARDANDO DADOS:** M√≠nimo de ${MIN_HISTORY_FOR_BOOSTER} lan√ßamentos necess√°rios. (${historyArr.length} / ${MIN_HISTORY_FOR_BOOSTER})`;
        }
        msg += '</span>';
        betSuggestionDiv.innerHTML = msg;
        return;
    }

    const triggerNum = historyArr[0];
    let betZone = [];
    let triggerCount = 0;
    let successors = [];

    // Tenta obter dados do estado (se o padr√£o j√° foi detectado) ou recalcula.
    if (config.boosterBetZone && config.boosterBetZone.length > 0 && config.boosterTriggerNum === triggerNum) {
        // Se a zona j√° existe para este gatilho, a I.A. est√° no modo de confirma√ß√£o ou pronta para apostar.
        betZone = config.boosterBetZone;
        
        // Recalcula o triggerCount e successors apenas para exibi√ß√£o
        const result = findBoosterSuccessors(triggerNum);
        triggerCount = result.triggerCount;
        successors = result.successors;

    } else {
        // Se a zona n√£o existe, recalcula o padr√£o.
        const result = findBoosterSuccessors(triggerNum);
        triggerCount = result.triggerCount;
        successors = result.successors;
        
        if (triggerCount >= CONFIRMATION_ROUNDS && successors.length > 0) {
            // Padr√£o Detectado e Confirmado pelo hist√≥rico (>= 4x)
            betZone = calculateBetZone(successors);
            
            // Salva a zona no estado e reseta confirma√ß√µes para iniciar o ciclo de espera/confirma√ß√£o
            config.boosterBetZone = betZone;
            config.boosterTriggerNum = triggerNum;
            config.boosterConfirmations = 0;
            saveConfig();
        } else {
            // Gatilho n√£o confirmado ou sem sucessores. Limpa o estado.
            delete config.boosterBetZone;
            delete config.boosterTriggerNum;
            config.boosterConfirmations = 0;
            saveConfig();
            
            betSuggestionDiv.innerHTML = `
                <span style="color:var(--alert-red); font-weight: bold;">
                    ‚ùå GATILHO N√ÉO CONFIRMADO:
                </span>
                <p style="margin-top: 5px; color: var(--muted); font-weight: normal;">
                    O √∫ltimo n√∫mero **${triggerNum}** se repetiu apenas **${triggerCount}x** como predecessor nos √∫ltimos ${SUCCESSOR_LOOKBACK} lances.
                    <br>
                    **M√≠nimo Requerido:** **${CONFIRMATION_ROUNDS}x**.
                </p>
            `;
            return;
        }
    }

    // --- RENDERIZA√á√ÉO DA ANIMA√á√ÉO DE CONFIRMA√á√ÉO ---
    
    // Confirma√ß√£o Bem-sucedida! Sugere a APOSTA.
    if (config.boosterConfirmations >= CONFIRMATION_ROUNDS_UI) {
        // Limpa o estado de confirma√ß√£o para for√ßar o pr√≥ximo ciclo a recome√ßar (Avan√ßar para o Pr√≥ximo Padr√£o)
        delete config.boosterBetZone;
        delete config.boosterTriggerNum;
        config.boosterConfirmations = 0;
        saveConfig();
        
        betSuggestionDiv.innerHTML = `
            <p style="margin-bottom: 5px;">
                GATILHO: <span class="iaGlow" style="font-size: 1.2em;">${triggerNum}</span> 
                <span style="color: var(--alert-green); font-size: 14px; font-weight: bold;"> (Confirmado ${triggerCount}x)</span>
            </p>
            
            <p class="status-text-ready">
                ‚úÖ CONFIRMA√á√ïES OBTIDAS!
            </p>

            <p style="font-size: 14px; margin-top: 10px; margin-bottom: 5px; color: var(--muted);">
                üéØ **APOSTE AGORA:** Zona Ampla (2 Vizinhos) dos Sucessores.
            </p>

            <div class="bet-zone-list">
                ${betZone.join(', ')}
            </div>
            <p style="font-size: 14px; margin-top: 5px; color: var(--muted);">
                Total de n√∫meros na zona: **${betZone.length}**
            </p>
            
            <p style="font-size: 14px; margin-top: 10px; color: var(--alert-green); font-weight: bold;">
                PR√ìXIMO CICLO: A I.A. ir√° procurar um novo gatilho.
            </p>
        `;
        return;
    }

    // Renderiza√ß√£o no Modo de Confirma√ß√£o (Padr√£o Detectado)
    let confirmationHtml = `<div class="confirmation-animation">
        <div class="conf-line" style="color: var(--status-pending); font-size: 1.1em;">
            <span class="conf-icon conf-pending">...</span>
            PADR√ÉO DETECTADO üü†
        </div>
        <p style="font-size: 12px; color: var(--muted); margin: 5px 0 10px 26px;">
            Gatilho: ${triggerNum} (Zona: ${betZone.length} n√∫meros)
        </p>
        <div style="margin-left: 10px;">
    `;

    for (let i = 1; i <= CONFIRMATION_ROUNDS_UI; i++) {
        const isConfirmed = i <= config.boosterConfirmations;
        const statusClass = isConfirmed ? 'conf-success' : 'conf-pending';
        const iconContent = isConfirmed ? '‚úî' : '...';
        const colorStyle = isConfirmed ? 'color: var(--status-success);' : 'color: var(--muted);';

        confirmationHtml += `
            <div class="conf-line" style="${colorStyle}">
                <span class="conf-icon ${statusClass}">${iconContent}</span>
                Aguardando Confirma√ß√£o ${i} ${isConfirmed ? 'üü¢ (OK)' : '...'}
            </div>
        `;
    }
    
    confirmationHtml += `</div></div>`;
    
    betSuggestionDiv.innerHTML = `
        <p style="margin-bottom: 5px;">
            GATILHO: <span class="iaGlow" style="font-size: 1.2em;">${triggerNum}</span> 
            <span style="color: var(--alert-green); font-size: 14px; font-weight: bold;"> (Confirmado ${triggerCount}x)</span>
        </p>

        <p style="font-size: 14px; margin-top: 10px; margin-bottom: 5px; color: var(--muted); font-weight: bold;">
            PR√ìXIMA A√á√ÉO: Aguardar **${CONFIRMATION_ROUNDS_UI - config.boosterConfirmations}** lances **FORA** desta Zona.
        </p>
        
        <div class="bet-zone-list" style="border-color: var(--status-pending); color: var(--status-pending); text-shadow: 0 0 8px rgba(255,195,0,0.8);">
            ${betZone.join(', ')}
        </div>
        <p style="font-size: 14px; margin-top: 5px; color: var(--muted);">
            Total de n√∫meros na zona: **${betZone.length}**
        </p>

        ${confirmationHtml}
    `;

  }

  // =========================================================================================
  // FIM DO NOVO C√ìDIGO INCLU√çDO/MODIFICADO
  // =========================================================================================
  
  
  // ================== FUN√á√ïES DE RENDERIZA√á√ÉO E UI (Ajustadas) ================== */
  
  function renderHistory() {
    historyDiv.innerHTML = ''; 
    historyCount.textContent = `${historyArr.length}/${MAX_HISTORY}`;
    
    if (historyArr.length === 0) {
        historyDiv.innerHTML = '<span style="color:var(--muted); font-style:italic;">Nenhum n√∫mero registrado.</span>';
        return;
    }
    
    historyArr.forEach((num, index) => {
        const colorClass = getColor(num);
        const chip = document.createElement('div');
        chip.className = `chip ${colorClass}`;
        chip.textContent = num;
        chip.title = `Ordem: ${index + 1}¬∫ | N√∫mero: ${num}`;
        chip.setAttribute('data-index', index);
        chip.addEventListener('click', () => removeNumberByIndex(index)); 
        historyDiv.appendChild(chip);
    });
  }
  
  // Fun√ß√µes UI (renderBankrollDashboard, renderBankrollHistory, renderGrid, updateClock, updateUI, EventListeners...) (Mantidas, mas updateUI chama renderBetSuggestion)
  
  
  
  // Fun√ß√£o de exclus√£o de n√∫mero (j√° existente)
  function removeNumberByIndex(index) {
    if (confirm(`Tem certeza que deseja remover o n√∫mero ${historyArr[index]} da posi√ß√£o ${index + 1} (o ${index + 1}¬∫ mais recente)?`)) {
        historyArr.splice(index, 1);
        
        // Resetamos as confirma√ß√µes se o n√∫mero removido for o √∫ltimo (gatilho) ou afetar a ordem.
        config.boosterConfirmations = 0;
        delete config.boosterBetZone;
        delete config.boosterTriggerNum;
        saveConfig();
        
        saveHistoryData();
        updateUI();
    }
  }

  // ... (Restante das fun√ß√µes de UI e Event Listeners) ...
  
  function renderBankrollDashboard() {
    const { initial, current, history } = bankrollState;
    const totalProfit = safeMath(current - initial);
    
    const profitClass = totalProfit >= 0 ? 'positive' : 'negative';
    const totalEntries = history.filter(item => item.amount !== 0).length;
    const totalWins = history.filter(item => item.amount > 0).length;
    const totalLosses = history.filter(item => item.amount < 0).length;
    const winRate = totalEntries > 0 ? safeMath((totalWins / totalEntries) * 100) : 0;
    
    let html = '';
    if (initial > 0) {
        html = `
            <div class="stat-item">
                <div class="stat-title">BANCA ATUAL</div>
                <div class="stat-value">${formatCurrency(current)}</div>
            </div>
            <div class="stat-item">
                <div class="stat-title">LUCRO / PREJU√çZO (TOTAL)</div>
                <div class="stat-value ${profitClass}">${formatCurrency(totalProfit)}</div>
            </div>
            <div class="stat-item">
                <div class="stat-title">TAXA DE VIT√ìRIA (W/L)</div>
                <div class="stat-value ${totalWins >= totalLosses ? 'positive' : 'negative'}">${winRate}%</div>
            </div>
            <div class="stat-item">
                <div class="stat-title">WINS / LOSSES</div>
                <div class="stat-value">${totalWins} / ${totalLosses}</div>
            </div>
        `;
    } else {
        html = `<span class="stat-title" style="grid-column: 1 / -1; color: var(--alert-red);">Defina sua banca inicial para ativar o Gerenciamento de Risco.</span>`;
    }
    
    document.getElementById('performanceDashboard').innerHTML = html;
  }

  function renderBankrollHistory() {
    bankrollHistoryDiv.innerHTML = '';
    const { history } = bankrollState;
    
    if (history.length === 0) {
        bankrollHistoryDiv.innerHTML = '<div class="log-item log-placeholder">Nenhum registro ainda.</div>';
        return;
    }
    
    history.slice().reverse().forEach((item, originalIndex) => {
        const index = history.length - 1 - originalIndex; // Para deletar o original
        const isWin = item.amount > 0;
        const logClass = isWin ? 'log-win' : 'log-loss';
        const sign = isWin ? '+' : '';

        const itemDiv = document.createElement('div');
        itemDiv.className = `log-item ${logClass}`;
        
        const date = new Date(item.timestamp);
        const timeStr = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        
        itemDiv.innerHTML = `
            <span>${timeStr} - ${isWin ? 'GREEN' : 'RED'}</span>
            <span style="font-weight: bold;">${sign}${formatCurrency(item.amount)}</span>
            <button class="log-delete-btn" data-index="${index}" title="Excluir este registro">
                <span class="material-symbols-outlined" style="font-size: 16px;">close</span>
            </button>
        `;
        bankrollHistoryDiv.appendChild(itemDiv);
    });

    bankrollHistoryDiv.querySelectorAll('.log-delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index, 10);
            deleteBankrollEntry(index);
        });
    });
  }
  
  function deleteBankrollEntry(index) {
    if (confirm('Tem certeza que deseja excluir este registro? Isso afetar√° sua banca e estat√≠sticas.')) {
        const deletedEntry = bankrollState.history[index];
        bankrollState.current = safeMath(bankrollState.current - deletedEntry.amount);
        bankrollState.history.splice(index, 1);
        saveBankrollData();
        updateUI();
        checkStopCondition();
    }
  }

  function renderGrid() {
    gridNumbers.innerHTML = '';
    
    const allNumbers = [...Array(37).keys()]; // 0 a 36
    allNumbers.forEach(num => {
        const btn = document.createElement('button');
        btn.className = `number-btn ${getColor(num)}`;
        btn.textContent = num;
        btn.addEventListener('click', () => addNumber(num));
        gridNumbers.appendChild(btn);
    });
  }

  let sessionTimerInterval;
  function updateClock() {
    const now = new Date();
    const clockDiv = document.getElementById('clock');
    clockDiv.textContent = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    
    if (config.isLoggedIn && config.sessionStart > 0) {
        const elapsed = Date.now() - config.sessionStart;
        const totalSeconds = Math.floor(elapsed / 1000);
        const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
        const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
        sessionTimerDiv.textContent = `Sess√£o: ${hours}:${minutes}`;
    }
  }
  
  function updateUI() {
    checkLockStatus(); 
    if (!getLoginStatus() || config.isLocked) return;

    calculateStats(); 
    renderHistory();
    renderBankrollDashboard();
    renderBankrollHistory();
    renderLatestSuccessors();
    renderZoneAnalysis();
    
    // ‚≠êÔ∏è Chama a nova fun√ß√£o do Booster I.A.
    renderBetSuggestion(); 
    
    // Tend√™ncias
    hotColdDiv.innerHTML = `
        üî• Hot: <span style="font-weight: bold; color: var(--red);">${numberStats.hotList.join(', ') || '-'}</span>
        <br>
        ‚ùÑÔ∏è Cold: <span style="font-weight: bold; color: var(--accent-secondary);">${numberStats.coldList.join(', ') || '-'}</span>
    `;
  }
  
  /* ================== EVENT LISTENERS ================== */
  
  // Login
  document.getElementById('btnSignInReal').addEventListener('click', () => {
      if (authPwdInput.value === getPasswordHash()) {
          setLoginStatus(true, 'REAL');
          updateUI();
      } else {
          alert('Senha incorreta.');
          authPwdInput.value = '';
      }
  });
  document.getElementById('btnSignInDemo').addEventListener('click', () => {
      setLoginStatus(true, 'DEMO');
      updateUI();
  });
  document.getElementById('logoutBtn').addEventListener('click', () => {
      setLoginStatus(false, 'DEMO');
      updateUI();
  });
  
  // Banca
  document.getElementById('btnSetBankroll').addEventListener('click', () => {
    const amount = parseFloat(initialBankrollInput.value);
    if (isNaN(amount) || amount <= 0) {
        alert('Por favor, insira um valor inicial de banca v√°lido (maior que zero).');
        return;
    }
    bankrollState.initial = safeMath(amount);
    bankrollState.current = safeMath(amount);
    bankrollState.history = []; // Limpa o hist√≥rico ao redefinir
    saveBankrollData();
    updateUI();
  });

  function registerTransaction(type) {
    if (bankrollState.initial === 0) {
        alert('Defina a Banca Inicial primeiro.');
        return;
    }
    const input = parseFloat(betAmountInput.value);
    if (isNaN(input) || input <= 0) {
        alert('Insira um valor v√°lido para o ganho/perda (maior que zero).');
        return;
    }
    
    const amount = safeMath(type === 'win' ? input : -input);
    
    bankrollState.current = safeMath(bankrollState.current + amount);
    bankrollState.history.push({
        amount: amount,
        timestamp: Date.now()
    });
    
    betAmountInput.value = ''; 
    saveBankrollData();
    updateUI();
    checkStopCondition();
  }

  btnRegisterWin.addEventListener('click', () => registerTransaction('win'));
  btnRegisterLoss.addEventListener('click', () => registerTransaction('loss'));
  
  // Hist√≥rico
  clearBtn.addEventListener('click', () => {
    if (confirm('Tem certeza que deseja limpar todo o Hist√≥rico de N√∫meros?')) {
        historyArr = [];
        // Limpa estado do Booster
        config.boosterConfirmations = 0;
        delete config.boosterBetZone;
        delete config.boosterTriggerNum;
        saveConfig();
        
        saveHistoryData();
        updateUI();
    }
  });

  // Upload/OCR
  btnUpload.addEventListener('click', () => { uploadPhotoInput.click(); });

  uploadPhotoInput.addEventListener('change', async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    alert('Iniciando an√°lise OCR da imagem. Isso pode levar alguns segundos...');
    
    try {
        const { data: { text } } = await Tesseract.recognize(
            file,
            'eng', // Usamos 'eng' que funciona bem para n√∫meros
            {
                tessedit_char_whitelist: '0123456789 ',
                logger: m => console.log(m)
            }
        );
        
        // Extrai todos os n√∫meros sequenciais da string
        const numbersFound = text.match(/\d+/g); 
        
        if (numbersFound && numbersFound.length > 0) {
            const uniqueNumbers = numbersFound
                .map(n => parseInt(n, 10))
                .filter(n => !isNaN(n) && n >= 0 && n <= 36);

            if (uniqueNumbers.length > 0) {
                 const confirmation = confirm(`N√∫meros identificados na imagem (do mais recente para o mais antigo, se a ordem estiver correta): ${uniqueNumbers.join(', ')}. Adicionar ao hist√≥rico?`);
                 if (confirmation) {
                     addMultipleNumbers(uniqueNumbers);
                 }
            } else {
                alert('OCR n√£o conseguiu identificar n√∫meros v√°lidos (0-36).');
            }
        } else {
            alert('Nenhum n√∫mero encontrado pelo OCR.');
        }

    } catch (error) {
        console.error('OCR Error:', error);
        alert('Erro ao processar a imagem com OCR.');
    } finally {
        // Limpa o input para permitir upload do mesmo arquivo novamente
        uploadPhotoInput.value = '';
    }
  });
  
  // Bloqueio
  btnSkipLock.addEventListener('click', skipLock);
  
  // Inicializa√ß√£o
  loadConfig();
  loadHistoryData();
  loadBankrollData();
  renderGrid(); 
  updateUI();
  
  // Loop de rel√≥gio e timer
  setInterval(updateClock, 1000); 

  // Re-checar o Stop Condition e UI a cada 1 minuto (seguran√ßa)
  setInterval(updateUI, 60000); 

});
</script>

</body>
</html>

